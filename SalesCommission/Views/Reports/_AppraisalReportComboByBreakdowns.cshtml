@model SalesCommission.Models.AppraisalReportModel

@{ 
    System.Globalization.NumberFormatInfo nfi = new System.Globalization.CultureInfo("en-US", false).NumberFormat;
    nfi.CurrencyDecimalDigits = 0;
    nfi.PercentDecimalDigits = 1;
    nfi.PercentPositivePattern = 1;
    nfi.CurrencySymbol = "";

    var applicationPath = Request.ApplicationPath;

    if (applicationPath == "/")
    {
        applicationPath = "";
    }

    var breakDownCombos = new List<string>();
    var breakDownComboValues = new List<string>();

    breakDownCombos.Add("Appraiser");
    breakDownComboValues.Add("appraiser");

    breakDownCombos.Add("Certification");
    breakDownComboValues.Add("certified");

    breakDownCombos.Add("Days In Stock");
    breakDownComboValues.Add("days");

    breakDownCombos.Add("Location");
    breakDownComboValues.Add("soldloc");

    breakDownCombos.Add("Make");
    breakDownComboValues.Add("make");

    breakDownCombos.Add("Mileage");
    breakDownComboValues.Add("mileage");

    breakDownCombos.Add("Model");
    breakDownComboValues.Add("model");

    breakDownCombos.Add("Model Year");
    breakDownComboValues.Add("modelyear");

    breakDownCombos.Add("Month Year");
    breakDownComboValues.Add("monthyear");

    breakDownCombos.Add("Selling Price");
    breakDownComboValues.Add("price");

    breakDownCombos.Add("Showroom");
    breakDownComboValues.Add("showroom");

    breakDownCombos.Add("Vehicle Source");
    breakDownComboValues.Add("vehiclesource");


}

<style type="text/css">
    .indent-2{        
        padding-left:10px;
    }
    .indent-3{
        padding-left:20px;
    }
    .indent-4{
        padding-left:30px;
    }
    table.floatThead-table {
        font-size:12px;
    }

    .indent-td2{
        display: block;
        margin-left: 10px;
        margin-right: -2px;
    }
    .indent-td3{
        display: block;
        margin-left: 20px;
        margin-right: -2px;
    }
    .indent-td4{
        display: block;
        margin-left: 30px;
        margin-right: -2px;
    }
    .breakdown-column{
        width:250px;
    }
</style>

<div class="col-sm-12" id="location-associate">


    <div class="row report-parameters" style="padding:10px 0px;margin-bottom:10px;">
        @using (Html.BeginForm("AppraisalReport", "Reports", FormMethod.Post, new { name = "FilterForm", id = "FilterForm" }))
        {
            
            @Html.Hidden("bd1", Model.BreakDownLevel1);
            @Html.Hidden("bd2", Model.BreakDownLevel2);
            @Html.Hidden("bd3", Model.BreakDownLevel3);
            @Html.Hidden("bd4", Model.BreakDownLevel4);

            @Html.Hidden("startmonth", Model.ReportStartMonth.ToString());
            @Html.Hidden("startyear", Model.ReportStartYear.ToString());
            @Html.Hidden("endmonth", Model.ReportEndMonth.ToString());
            @Html.Hidden("endyear", Model.ReportEndYear.ToString());
            @Html.Hidden("vt", Model.VehicleType);
            @Html.Hidden("at", Model.AcquisitionType);
            @Html.Hidden("rt", Model.ReportType);
            @Html.Hidden("st", Model.StatusType);
            @Html.Hidden("sfm", Model.StatusOnFM);


            if (@Model.BreakDownLevel1 != null && @Model.BreakDownLevel1 != "")
            {
                var index = breakDownComboValues.IndexOf(Model.BreakDownLevel1);

            <div class="col-sm-2">
                @breakDownCombos[index]
                <select name="filterBreakdown1" id="filterBreakdown1" class="form-control form-inline chosen-select " multiple>
                    <option></option>
                </select>
            </div>
        }
        if (@Model.BreakDownLevel2 != null && @Model.BreakDownLevel2 != "")
        {
            var index = breakDownComboValues.IndexOf(Model.BreakDownLevel2);

            <div class="col-sm-2">
                @breakDownCombos[index]
                <select name="filterBreakdown2" id="filterBreakdown2" class="form-control form-inline chosen-select " multiple>
                    <option></option>
                </select>
            </div>
        }
        if (@Model.BreakDownLevel3 != null && @Model.BreakDownLevel3 != "")
        {
            var index = breakDownComboValues.IndexOf(Model.BreakDownLevel3);

            <div class="col-sm-2">
                @breakDownCombos[index]
                <select name="filterBreakdown3" id="filterBreakdown3" class="form-control form-inline chosen-select " multiple>
                    <option></option>
                </select>
            </div>
        }
        if (@Model.BreakDownLevel4 != null && @Model.BreakDownLevel4 != "")
        {
            var index = breakDownComboValues.IndexOf(Model.BreakDownLevel4);

            <div class="col-sm-2">
                @breakDownCombos[index]
                <select name="filterBreakdown4" id="filterBreakdown4" class="form-control form-inline chosen-select " multiple>
                    <option></option>
                </select>
            </div>
        }
        <div class="col-sm-2">
            <button class="btn btn-primary" style="margin-top:15px" type="submit" value="Filter" name="Filter">Filter</button>
        </div>
        }
    </div>
    <h4>Appraisal Combination Report</h4>

    <table class="table table-bordered" style="font-size:12px">
        <thead>

            <tr style="background-color:#d9edf7;">
                <th class="text-center breakdown-column">Company Totals</th>
                <th class="text-center">Total </th>
                <th class="text-center">Days Supply /<br/>Trades </th>
                <th class="text-center">Total <br />Value $</th>
                <th class="text-center"> < 30 Day<br />Units</th>
                <th class="text-center"> < 30 Day<br />% of Inv</th>
                <th class="text-center">30-59 Day<br />Units</th>
                <th class="text-center">30-59 Day<br />% of Inv</th>
                <th class="text-center">60-89 Day<br />Units</th>
                <th class="text-center">60-89 Day<br />% of Inv</th>
                <th class="text-center">90+ Day<br />Units</th>
                <th class="text-center">90+ Day<br />% of Inv</th>
                <th class="text-center">Avg FitzWay<br />Low Price</th>
                <th class="text-center">Avg Inventory<br />Amount</th>
                <th class="text-center">Avg Current<br />Markup/(Loss)</th>
                <th class="text-center">Avg Front End Profit</th>
                <th class="text-center">Avg Back End Profit</th>
                <th class="text-center">Avg Gross Profit</th>
            </tr>


            </thead>
            <tbody>

                @{ 
                    var TotalCount = Model.TradeAcquisitionDetails.Count;
                    var TotalSoldCount = Model.AppraisalSoldDetails.Count;

                    var TotalWithCost = 0;
                    var TotalWithInvAmount = 0;

                    decimal TotalInvAmount = 0;
                    decimal TotalFitzWayAmount = 0;
                    decimal TotalMarkup = 0;

                    decimal Day30Count = 0;
                    decimal Day3060Count = 0;
                    decimal Day6090Count = 0;
                    decimal Day90Count = 0;

                    decimal Day30Percent = 0;
                    decimal Day3060Percent = 0;
                    decimal Day6090Percent = 0;
                    decimal Day90Percent = 0;

                    decimal Day30SoldCount = 0;
                    decimal Day3060SoldCount = 0;
                    decimal Day6090SoldCount = 0;
                    decimal Day90SoldCount = 0;

                    decimal Day30SoldPercent = 0;
                    decimal Day3060SoldPercent = 0;
                    decimal Day6090SoldPercent = 0;
                    decimal Day90SoldPercent = 0;

                    decimal TotalSoldAmount = 0;
                    decimal TotalFitzWaySoldAmount = 0;
                    decimal TotalMarkupSold = 0;

                    decimal totalFrontEnd = 0;
                    decimal totalBackEnd = 0;
                    decimal totalAvgProfit = 0;

                    decimal avgFrontEnd = 0;
                    decimal avgBackEnd = 0;
                    decimal avgProfit = 0;

                    decimal MarkupAverage = 0;
                    decimal FitzAverage = 0;
                    decimal InventoryAverage = 0;

                    decimal TradePercentage = 0;

                    int TotalTradeCount = 0;

                    foreach (var detail in Model.TradeAcquisitionDetails)
                    {
                        var days = Int32.Parse(detail.Days);
                        if (days < 30)
                        {
                            Day30Count += 1;
                        }
                        else if (days >= 30 && days < 60)
                        {
                            Day3060Count += 1;
                        }
                        else if (days >= 60 && days < 90)
                        {
                            Day6090Count += 1;
                        }
                        else if (days >= 90)
                        {
                            Day90Count += 1;
                        }


                        TotalInvAmount += detail.InventoryAmount;

                        if (detail.ListAmount > 0)
                        {
                            TotalWithCost += 1;
                            TotalFitzWayAmount += detail.ListAmount;
                        }


                        var halfListAmount = (detail.ListAmount * (decimal).5);
                        if (detail.InventoryAmount > halfListAmount)
                        {
                            TotalWithInvAmount += 1;
                            TotalMarkup += (detail.ListAmount - detail.InventoryAmount);
                        }

                    }
                    if (TotalCount > 0)
                    {
                        Day30Percent = (Day30Count / TotalCount);
                        Day3060Percent = (Day3060Count / TotalCount);
                        Day6090Percent = (Day6090Count / TotalCount);
                        Day90Percent = (Day90Count / TotalCount);

                    }

                    if (TotalWithCost > 0)
                    {
                        FitzAverage = (TotalFitzWayAmount / TotalWithCost);
                    }

                    if (TotalWithInvAmount > 0)
                    {
                        MarkupAverage = (TotalMarkup / TotalWithInvAmount);
                        InventoryAverage = (TotalInvAmount / TotalWithInvAmount);
                    }

                    foreach (var detail in Model.AppraisalSoldDetails)
                    {

                        if (detail.WholesaleRetail == "R")
                        {
                            totalFrontEnd += detail.SL_FrontEndProfit;
                            totalBackEnd += detail.SL_BackEndProfit;
                            totalAvgProfit += detail.SL_AverageGrossProfit;
                        }
                        else
                        {
                            totalFrontEnd += detail.FrontEndProfit;
                            totalBackEnd += detail.BackEndProfit;
                            totalAvgProfit += detail.AverageGrossProfit;
                        }

                        var days = Int32.Parse(detail.DaysInStock);
                        if (days < 30)
                        {
                            Day30SoldCount += 1;
                        }
                        else if (days >= 30 && days < 60)
                        {
                            Day3060SoldCount += 1;
                        }
                        else if (days >= 60 && days < 90)
                        {
                            Day6090SoldCount += 1;
                        }
                        else if (days >= 90)
                        {
                            Day90SoldCount += 1;
                        }

                        TotalSoldAmount += detail.SellingPrice;
                        TotalTradeCount += detail.TradeCount;
                        //TotalFitzWaySoldAmount += detail.;
                        //TotalMarkupSold += (detail.ListAmount - detail.InventoryAmount);

                    }
                    if (TotalSoldCount > 0)
                    {
                        avgFrontEnd = (totalFrontEnd / TotalSoldCount);
                        avgBackEnd = (totalBackEnd / TotalSoldCount);
                        avgProfit = (totalAvgProfit / TotalSoldCount);
                        Day30SoldPercent = (Day30SoldCount / TotalSoldCount);
                        Day3060SoldPercent = (Day3060SoldCount / TotalSoldCount);
                        Day6090SoldPercent = (Day6090SoldCount / TotalSoldCount);
                        Day90SoldPercent = (Day90SoldCount / TotalSoldCount);
                        TradePercentage = ((decimal)TotalTradeCount / TotalSoldCount);
                    }

                    decimal TotalDaysSupply = 0;
                    decimal TotalSoldLast30 = 0;

                    var SupplyOutput = "";


                    var soldLast30 = Model.AppraisalSoldDetails.FindAll(x => x.DealDate > DateTime.Now.AddDays(-31));
                    if (soldLast30 != null)
                    {
                        TotalSoldLast30 = soldLast30.Count;
                    }

                    if (TotalSoldLast30 != 0)
                    {
                        TotalDaysSupply = (30 / TotalSoldLast30) * TotalCount;
                        SupplyOutput = decimal.ToInt32(TotalDaysSupply).ToString();
                    }
                    else
                    {
                        SupplyOutput = "Err";
                    }                    

                }

                <tr>
                    <td class="text-center breakdown-column">Current Inventory</td>
                    <td class="text-center">@TotalCount</td>
                    <td class="text-center">@SupplyOutput</td>
                    <td class="text-center">@TotalInvAmount.ToString("C",nfi)</td>
                    <td class="text-center">@Day30Count</td>
                    <td class="text-center">@Day30Percent.ToString("P", nfi)</td>
                    <td class="text-center">@Day3060Count</td>
                    <td class="text-center">@Day3060Percent.ToString("P", nfi)</td>
                    <td class="text-center">@Day6090Count</td>
                    <td class="text-center">@Day6090Percent.ToString("P", nfi)</td>
                    <td class="text-center">@Day90Count</td>
                    <td class="text-center">@Day90Percent.ToString("P", nfi)</td>
                    <td class="text-center">@FitzAverage.ToString("C", nfi)</td>
                    <td class="text-center">@InventoryAverage.ToString("C", nfi)</td>
                    <td class="text-center">@MarkupAverage.ToString("C", nfi)</td>
                    <td class="text-center"></td>
                    <td class="text-center"></td>
                    <td class="text-center"></td>
                </tr>
                <tr>
                    <td class="text-center breakdown-column">Sold Vehicles</td>
                    <td class="text-center">@TotalSoldCount</td>
                    <td class="text-center">@TotalTradeCount (@TradePercentage.ToString("P", nfi))</td>
                    <td class="text-center">@TotalSoldAmount.ToString("C", nfi)</td>
                    <td class="text-center">@Day30SoldCount</td>
                    <td class="text-center">@Day30SoldPercent.ToString("P", nfi)</td>
                    <td class="text-center">@Day3060SoldCount</td>
                    <td class="text-center">@Day3060SoldPercent.ToString("P", nfi)</td>
                    <td class="text-center">@Day6090SoldCount</td>
                    <td class="text-center">@Day6090SoldPercent.ToString("P", nfi)</td>
                    <td class="text-center">@Day90SoldCount</td>
                    <td class="text-center">@Day90SoldPercent.ToString("P", nfi)</td>
                    <td class="text-center">@TotalFitzWaySoldAmount.ToString("C", nfi)</td>
                    <td class="text-center">@TotalMarkupSold.ToString("C", nfi)</td>
                    <td class="text-center">0</td>
                    <td class="text-center">@avgFrontEnd.ToString("C", nfi)</td>
                    <td class="text-center">@avgBackEnd.ToString("C", nfi)</td>
                    <td class="text-center">@avgProfit.ToString("C", nfi)</td>
                </tr>

            </tbody>
            <tfoot>
                <tr style="background-color:#d9edf7;">
                </tr>

            </tfoot>
        </table>
    <table class="table table-bordered sticky-header" style="font-size:12px; border-left: none;">
        <thead>
            <tr style="background-color:#d9edf7;">
                <th class="text-center breakdown-column">Breakdown</th>
                <th class="text-center"></th>
                <th class="text-center">Total</th>
                <th class="text-center">Days Supply /<br />Trades </th>
                <th class="text-center">Total <br />Value $</th>
                <th class="text-center"> < 30 Day<br />Units</th>
                <th class="text-center"> < 30 Day<br />% of Inv</th>
                <th class="text-center">30-59 Day<br />Units</th>
                <th class="text-center">30-59 Day<br />% of Inv</th>
                <th class="text-center">60-89 Day<br />Units</th>
                <th class="text-center">60-89 Day<br />% of Inv</th>
                <th class="text-center">90+ Day<br />Units</th>
                <th class="text-center">90+ Day<br />% of Inv</th>
                <th class="text-center">Avg FitzWay<br />Low Price</th>
                <th class="text-center">Avg Inventory<br />Amount</th>
                <th class="text-center">Avg Current<br />Markup/(Loss)</th>
                <th class="text-center">Avg Front End Profit</th>
                <th class="text-center">Avg Back End Profit</th>
                <th class="text-center">Avg Gross Profit</th>
            </tr>

        </thead>
        <tbody>

    @if (Model.TradeAcquisitionDetails != null)
    {

        var breakdownLevel1Values = new List<string>();


        switch (Model.BreakDownLevel1)
        {
            case "appraiser":
                var tempAppraiserValues = new List<string>();
                tempAppraiserValues = Model.AppraisalSoldDetails.Select(x => x.Appraiser).Distinct().OrderBy(x => x).ToList();
                tempAppraiserValues.AddRange(Model.TradeAcquisitionDetails.Select(x => x.Appraiser).Distinct().OrderBy(x => x).ToList());

                breakdownLevel1Values = tempAppraiserValues.Distinct().OrderBy(x => x).ToList();
                break;

            case "certified":
                //var tempCertifiedValues = new List<string>();

                ////tempCertifiedValues = Model.AppraisalSoldDetails.Select(x => x.Certification.Trim()).Distinct().OrderBy(x => x).ToList();
                //tempCertifiedValues.AddRange(Model.TradeAcquisitionDetails.Select(x => x.Certification.Trim()).Distinct().OrderBy(x => x).ToList());

                //breakdownLevel1Values = tempCertifiedValues.Distinct().OrderBy(x => x).ToList();

                breakdownLevel1Values.Add("FitzWay Value");
                breakdownLevel1Values.Add("FitzWay Plus");
                breakdownLevel1Values.Add("FitzWay Certified");
                breakdownLevel1Values.Add("FitzWay Handyman");
                breakdownLevel1Values.Add("Manufacturer CPO");
                breakdownLevel1Values.Add("Other");

                break;

            case "days":
                breakdownLevel1Values.Add("30");
                breakdownLevel1Values.Add("60");
                breakdownLevel1Values.Add("90");
                breakdownLevel1Values.Add("120");
                break;

            case "soldloc":
                var tempLocValues = new List<string>();

                tempLocValues = Model.AppraisalSoldDetails.Select(x => x.SoldLocation).Distinct().OrderBy(x => x).ToList();
                tempLocValues.AddRange(Model.TradeAcquisitionDetails.Select(x => x.DRloc.ToUpper()).Distinct().OrderBy(x => x).ToList());

                breakdownLevel1Values = tempLocValues.Distinct().OrderBy(x => x).ToList();

                if (breakdownLevel1Values.Contains("FAM") && breakdownLevel1Values.Contains("FCG"))
                {
                    breakdownLevel1Values.Remove("FCG");
                }

                if (breakdownLevel1Values.Contains("FTN") && breakdownLevel1Values.Contains("FTO"))
                {
                    breakdownLevel1Values.Remove("FTO");
                }

                break;

            case "make":
                var tempMakeValues = new List<string>();

                tempMakeValues = Model.AppraisalSoldDetails.Where(x => !x.Make.Contains("Used")).Select(x => x.Make).Distinct().OrderBy(x => x).ToList();
                tempMakeValues.AddRange(Model.TradeAcquisitionDetails.Where(x => !x.Make.Contains("Used")).Select(x => x.Make.ToUpper()).Distinct().OrderBy(x => x).ToList());

                breakdownLevel1Values = tempMakeValues.Distinct().OrderBy(x => x).ToList();
                break;

            case "mileage":
                breakdownLevel1Values.Add("25000");
                breakdownLevel1Values.Add("50000");
                breakdownLevel1Values.Add("75000");
                breakdownLevel1Values.Add("100000");
                breakdownLevel1Values.Add("500000");
                break;

            case "model":
                var tempModelValues = new List<string>();

                tempModelValues = Model.AppraisalSoldDetails.Select(x => x.Model).Distinct().OrderBy(x => x).ToList();
                tempModelValues.AddRange(Model.TradeAcquisitionDetails.Select(x => x.Carline).Distinct().OrderBy(x => x).ToList());

                breakdownLevel1Values = tempModelValues.Distinct().OrderBy(x => x).ToList();
                break;

            case "modelyear":
                var tempYearValues = new List<string>();

                tempYearValues = Model.AppraisalSoldDetails.Select(x => x.Year).Distinct().OrderBy(x => x).ToList();
                tempYearValues.AddRange(Model.TradeAcquisitionDetails.Select(x => x.Year).Distinct().OrderBy(x => x).ToList());

                breakdownLevel1Values = tempYearValues.Distinct().OrderBy(x => x).ToList();
                break;

            case "monthyear":
                var tempMonthYearValues = new List<string>();

                var monthYears = Model.TradeAcquisitionDetails.Select(x => x.LastModifiedDate.ToString("MM/yyyy")).Distinct().OrderBy(x => Convert.ToDateTime(x)).ToList();
                tempMonthYearValues = monthYears.Distinct().OrderBy(x => Convert.ToDateTime(x)).ToList();

                var monthYearsSold = Model.AppraisalSoldDetails.Select(x => x.DealMonthYear.ToString("MM/yyyy")).Distinct().OrderBy(x => Convert.ToDateTime(x)).ToList();
                tempMonthYearValues.AddRange(monthYearsSold.Distinct().OrderBy(x => Convert.ToDateTime(x)).ToList());

                breakdownLevel1Values = tempMonthYearValues.Distinct().OrderBy(x => x).ToList();
                break;

            //case "associate":
            //    breakdownLevel1Values = Model.AppraisalSoldDetails.Select(x => x.SalesAssociate).Distinct().OrderBy(x => x).ToList();
            //    break;

            case "price":
                breakdownLevel1Values.Add("10000");
                breakdownLevel1Values.Add("20000");
                breakdownLevel1Values.Add("30000");
                breakdownLevel1Values.Add("40000");
                breakdownLevel1Values.Add("50000");
                breakdownLevel1Values.Add("60000");
                breakdownLevel1Values.Add("70000");
                breakdownLevel1Values.Add("80000");
                breakdownLevel1Values.Add("90000");
                breakdownLevel1Values.Add("100000");
                breakdownLevel1Values.Add("200000");
                break;

            case "showroom":
                var tempShowroomValues = new List<string>();


                //tempShowroomValues = Model.AppraisalSoldDetails.Select(x => x.Showroom).Distinct().OrderBy(x => x).ToList();

                tempShowroomValues.AddRange(Model.TradeAcquisitionDetails.Select(x => x.Loc.ToUpper()).Distinct().OrderBy(x => x).ToList());

                breakdownLevel1Values = tempShowroomValues.Distinct().OrderBy(x => x).ToList();
                break;

            //case "stock":
            //    var tempStockValues = new List<string>();

            //    tempStockValues = Model.AppraisalSoldDetails.Select(x => x.StockNumber).Distinct().OrderBy(x => x).ToList();
            //    tempStockValues.AddRange(Model.TradeAcquisitionDetails.Select(x => x.StockNumber).Distinct().OrderBy(x => x).ToList());

            //    breakdownLevel1Values = tempStockValues.Distinct().OrderBy(x => x).ToList();
            //    break;

            case "vehiclesource":
                var tempSourceValues = new List<string>();

                tempSourceValues = Model.AppraisalSoldDetails.Select(x => x.VehicleSource).Distinct().OrderBy(x => x).ToList();
                tempSourceValues.AddRange(Model.TradeAcquisitionDetails.Select(x => x.VehicleSource).Distinct().OrderBy(x => x).ToList());

                breakdownLevel1Values = tempSourceValues.Distinct().OrderBy(x => x).ToList();
                break;

            //case "zipcode":
            //    breakdownLevel1Values = Model.AppraisalSoldDetails.Select(x => x.ZipCode).Distinct().OrderBy(x => x).ToList();
            //    break;



            default:
                // breakdownLevel1Values = Model.AssociateLeads.Select(x => x.DealerId.ToString()).Distinct().OrderBy(x => x).ToList();
                break;
        }

        <script type="text/javascript">
            $("#filterBreakdown1").empty();
            $("#filterBreakdown1").append("<option value=''></option>");
            $("#filterBreakdown2").empty();
            $("#filterBreakdown2").append("<option value=''></option>");
            $("#filterBreakdown3").empty();
            $("#filterBreakdown3").append("<option value=''></option>");
            $("#filterBreakdown4").empty();
            $("#filterBreakdown4").append("<option value=''></option>");
        </script>

        var breakdown1Index = 0;
        var breakdown2Index = 0;
        var BreakDown3Index = 0;
        var BreakDown4Index = 0;

        foreach (var breakdown1 in breakdownLevel1Values)
        {
            var label1 = breakdown1;

            var BreakDown1filteredLeads = new List<SalesCommission.Models.TradeAcquisitionDetail>();
            var BreakDown1filteredLeadsSold = new List<SalesCommission.Models.AppraisalSoldDetail>();

            switch (Model.BreakDownLevel1)
            {
                case "appraiser":
                    BreakDown1filteredLeads = Model.TradeAcquisitionDetails.FindAll(x => x.Appraiser == breakdown1);
                    BreakDown1filteredLeadsSold = Model.AppraisalSoldDetails.FindAll(x => x.Appraiser == breakdown1);
                    break;

                case "certified":

                    switch (breakdown1)
                    {
                        case "FitzWay Value":
                            BreakDown1filteredLeads = Model.TradeAcquisitionDetails.FindAll(x => x.Certification.Trim() == "F915");
                            BreakDown1filteredLeadsSold = Model.AppraisalSoldDetails.FindAll(x => x.Certification.Trim() == "FW");
                            break;
                        case "FitzWay Plus":
                            BreakDown1filteredLeads = Model.TradeAcquisitionDetails.FindAll(x => x.Certification.Trim() == "F914");
                            BreakDown1filteredLeadsSold = Model.AppraisalSoldDetails.FindAll(x => x.Certification.Trim() == "FP");
                            break;
                        case "FitzWay Certified":
                            BreakDown1filteredLeads = Model.TradeAcquisitionDetails.FindAll(x => x.Certification.Trim() == "F910");
                            BreakDown1filteredLeadsSold = Model.AppraisalSoldDetails.FindAll(x => x.Certification.Trim() == "FC");
                            break;
                        case "FitzWay Handyman":
                            BreakDown1filteredLeads = Model.TradeAcquisitionDetails.FindAll(x => x.Certification.Trim() == "F916" || x.Certification.Trim() == "F917" || x.Certification.Trim() == "F918");
                            BreakDown1filteredLeadsSold = Model.AppraisalSoldDetails.FindAll(x => x.Certification.Trim() == "HDM");
                            break;
                        case "Manufacturer CPO":
                            BreakDown1filteredLeads = Model.TradeAcquisitionDetails.FindAll(x => x.Certification.Trim() == "F906" || x.Certification.Trim() == "F907" || x.Certification.Trim() == "F908" || x.Certification.Trim() == "F909" || x.Certification.Trim() == "F911" || x.Certification.Trim() == "F912" || x.Certification.Trim() == "F913" || x.Certification.Trim() == "F922" || x.Certification.Trim() == "F923");
                            BreakDown1filteredLeadsSold = Model.AppraisalSoldDetails.FindAll(x => x.Certification.Trim() == "MC" || x.Certification.Trim() == "CUV" || x.Certification.Trim() == "MZC" || x.Certification.Trim() == "GMU" || x.Certification.Trim() == "VWC" || x.Certification.Trim() == "CPO");
                            break;
                        case "Other":
                            BreakDown1filteredLeads = Model.TradeAcquisitionDetails.FindAll(x => x.Certification.Trim() == "");
                            BreakDown1filteredLeadsSold = Model.AppraisalSoldDetails.FindAll(x => x.Certification.Trim() == "");
                            break;

                    }

                    break;

                case "days":
                    var daysbreakdown = Convert.ToDecimal(breakdown1);

                    if (daysbreakdown == 120)
                    {
                        BreakDown1filteredLeads = Model.TradeAcquisitionDetails.FindAll(x => Convert.ToDecimal(x.Days) >= 90);
                        BreakDown1filteredLeadsSold = Model.AppraisalSoldDetails.FindAll(x => Convert.ToDecimal(Convert.ToDecimal(x.DaysInStock)) >= 90);
                        label1 = "> 90";
                    }
                    else
                    {
                        BreakDown1filteredLeads = Model.TradeAcquisitionDetails.FindAll(x => Convert.ToDecimal(x.Days) < daysbreakdown && Convert.ToDecimal(x.Days) >= (daysbreakdown - 30));
                        BreakDown1filteredLeadsSold = Model.AppraisalSoldDetails.FindAll(x => Convert.ToDecimal(x.DaysInStock) < daysbreakdown && Convert.ToDecimal(x.DaysInStock) >= (daysbreakdown - 30));
                        label1 = (daysbreakdown - 30) + " - " + (daysbreakdown - 1);
                    }
                    break;


                case "soldloc":

                    if (breakdown1 == "FAM")
                    {
                        BreakDown1filteredLeads = Model.TradeAcquisitionDetails.FindAll(x => x.DRloc == "FCG");
                        BreakDown1filteredLeadsSold = Model.AppraisalSoldDetails.FindAll(x => x.SoldLocation == "FAM");
                    }
                    else if (breakdown1 == "FTN")
                    {
                        BreakDown1filteredLeads = Model.TradeAcquisitionDetails.FindAll(x => x.DRloc == "FTO");
                        BreakDown1filteredLeadsSold = Model.AppraisalSoldDetails.FindAll(x => x.SoldLocation == "FTN");
                    }
                    else
                    {
                        BreakDown1filteredLeads = Model.TradeAcquisitionDetails.FindAll(x => x.DRloc == breakdown1);
                        BreakDown1filteredLeadsSold = Model.AppraisalSoldDetails.FindAll(x => x.SoldLocation == breakdown1);
                    }



                    foreach (var store in SalesCommission.Business.Enums.SoldLocations)
                    {
                        if (store.LocationId.ToLower().Trim() == breakdown1.ToLower().Trim())
                        {
                            label1 = store.Name;
                        }
                    }

                    break;

                case "make":
                    BreakDown1filteredLeads = Model.TradeAcquisitionDetails.FindAll(x => x.Make.ToUpper() == breakdown1);
                    BreakDown1filteredLeadsSold = Model.AppraisalSoldDetails.FindAll(x => x.Make.ToUpper() == breakdown1);
                    break;

                case "mileage":
                    var milesbreakdown = Convert.ToDecimal(breakdown1);

                    if (milesbreakdown == 500000)
                    {
                        BreakDown1filteredLeads = Model.TradeAcquisitionDetails.FindAll(x => Convert.ToDecimal(x.Miles) >= 100000);
                        BreakDown1filteredLeadsSold = Model.AppraisalSoldDetails.FindAll(x => Convert.ToDecimal(x.Miles) >= 100000);
                        label1 = "> 100000";
                    }
                    else
                    {
                        BreakDown1filteredLeads = Model.TradeAcquisitionDetails.FindAll(x => Convert.ToDecimal(x.Miles) < milesbreakdown && Convert.ToDecimal(x.Miles) >= (milesbreakdown - 25000));
                        BreakDown1filteredLeadsSold = Model.AppraisalSoldDetails.FindAll(x => Convert.ToDecimal(x.Miles) < milesbreakdown && Convert.ToDecimal(x.Miles) >= (milesbreakdown - 25000));
                        label1 = (milesbreakdown - 25000) + " - " + (milesbreakdown - 1);
                    }
                    break;

                case "model":
                    BreakDown1filteredLeads = Model.TradeAcquisitionDetails.FindAll(x => x.Carline == breakdown1);
                    BreakDown1filteredLeadsSold = Model.AppraisalSoldDetails.FindAll(x => x.Model == breakdown1);
                    break;

                case "modelyear":
                    BreakDown1filteredLeads = Model.TradeAcquisitionDetails.FindAll(x => x.Year == breakdown1);
                    BreakDown1filteredLeadsSold = Model.AppraisalSoldDetails.FindAll(x => x.Year == breakdown1);
                    break;

                case "monthyear":
                    BreakDown1filteredLeads = Model.TradeAcquisitionDetails.FindAll(x => x.LastModifiedDate.ToString("MM/yyyy") == breakdown1);
                    BreakDown1filteredLeadsSold = Model.AppraisalSoldDetails.FindAll(x => x.DealMonthYear.ToString("MM/yyyy") == breakdown1);
                    var dealDate = Convert.ToDateTime(breakdown1);
                    label1 = dealDate.Month + "/" + dealDate.Year;

                    break;

                //case "associate":
                //    BreakDown1filteredLeads = Model.TradeAcquisitionDetails.FindAll(x => x.Year == breakdown1);
                //    BreakDown1filteredLeadsSold = Model.AppraisalSoldDetails.FindAll(x => x.Year == breakdown1);
                //    break;

                case "price":
                    var pricebreakdown = Convert.ToDecimal(breakdown1);

                    if (pricebreakdown == 200000)
                    {
                        BreakDown1filteredLeads = Model.TradeAcquisitionDetails.FindAll(x => x.ListAmount >= 100000);
                        BreakDown1filteredLeadsSold = Model.AppraisalSoldDetails.FindAll(x => x.SellingPrice >= 100000);
                        label1 = "> 100000";
                    }
                    else
                    {
                        BreakDown1filteredLeads = Model.TradeAcquisitionDetails.FindAll(x => x.ListAmount < pricebreakdown && x.ListAmount >= (pricebreakdown - 10000));
                        BreakDown1filteredLeadsSold = Model.AppraisalSoldDetails.FindAll(x => x.SellingPrice < pricebreakdown && x.SellingPrice >= (pricebreakdown - 10000));
                        label1 = (pricebreakdown - 10000) + " - " + (pricebreakdown - 1);
                    }
                    break;

                case "showroom":
                    BreakDown1filteredLeads = Model.TradeAcquisitionDetails.FindAll(x => x.Loc == breakdown1);

                    var soldBreakdown = "";

                    foreach (var mapping in SalesCommission.Business.Enums.ShowroomIDMapping)
                    {
                        if (mapping.Name == breakdown1)
                        {
                            soldBreakdown = mapping.LocationId;
                            break;
                        }
                    }

                    BreakDown1filteredLeadsSold = Model.AppraisalSoldDetails.FindAll(x => x.Showroom == soldBreakdown);

                    foreach (var store in SalesCommission.Business.Enums.AppraisalLocations)
                    {
                        if (store.LocationId.ToLower().Trim() == breakdown1.ToLower().Trim())
                        {
                            label1 = store.Name;
                        }
                    }

                    break;

                //case "stock":
                //    BreakDown1filteredLeads = Model.TradeAcquisitionDetails.FindAll(x => x.StockNumber == breakdown1);
                //    BreakDown1filteredLeadsSold = Model.AppraisalSoldDetails.FindAll(x => x.StockNumber == breakdown1);
                //    break;

                case "vehiclesource":
                    BreakDown1filteredLeads = Model.TradeAcquisitionDetails.FindAll(x => x.VehicleSource == breakdown1);
                    BreakDown1filteredLeadsSold = Model.AppraisalSoldDetails.FindAll(x => x.VehicleSource == breakdown1);
                    break;

                default:
                    BreakDown1filteredLeads = Model.TradeAcquisitionDetails.FindAll(x => x.Loc == breakdown1);
                    break;
            }

            var BD1TotalCount = BreakDown1filteredLeads.Count;
            var BD1TotalSoldCount = BreakDown1filteredLeadsSold.Count;

            decimal BD1TotalInvAmount = 0;
            decimal BD1TotalFitzWayAmount = 0;
            decimal BD1TotalMarkup = 0;

            decimal BD1Day30Count = 0;
            decimal BD1Day3060Count = 0;
            decimal BD1Day6090Count = 0;
            decimal BD1Day90Count = 0;

            decimal BD1Day30Percent = 0;
            decimal BD1Day3060Percent = 0;
            decimal BD1Day6090Percent = 0;
            decimal BD1Day90Percent = 0;

            decimal BD1TotalSoldAmount = 0;
            decimal BD1TotalFitzWaySoldAmount = 0;
            decimal BD1TotalMarkupSold = 0;

            decimal BD1Day30SoldCount = 0;
            decimal BD1Day3060SoldCount = 0;
            decimal BD1Day6090SoldCount = 0;
            decimal BD1Day90SoldCount = 0;

            decimal BD1Day30SoldPercent = 0;
            decimal BD1Day3060SoldPercent = 0;
            decimal BD1Day6090SoldPercent = 0;
            decimal BD1Day90SoldPercent = 0;

            decimal BD1TotalFrontEnd = 0;
            decimal BD1TotalBackEnd = 0;
            decimal BD1TotalAvgProfit = 0;
            decimal BD1AvgFrontEnd = 0;
            decimal BD1AvgBackEnd = 0;
            decimal BD1AvgProfit = 0;

            string BD1TradeDeals = "";
            var BD1TotalWithCost = 0;
            var BD1TotalWithInvAmount = 0;

            decimal BD1MarkupAverage = 0;
            decimal BD1FitzAverage = 0;
            decimal BD1InventoryAverage = 0;

            int BD1TradeCount = 0;
            decimal BD1TradePercentage = 0;

            foreach (var detail in BreakDown1filteredLeads)
            {
                var days = Int32.Parse(detail.Days);
                if (days < 30)
                {
                    BD1Day30Count += 1;
                }
                else if (days >= 30 && days < 60)
                {
                    BD1Day3060Count += 1;
                }
                else if (days >= 60 && days < 90)
                {
                    BD1Day6090Count += 1;
                }
                else if (days >= 90)
                {
                    BD1Day90Count += 1;
                }


                if (detail.ListAmount > 0)
                {
                    BD1TotalWithCost += 1;
                    BD1TotalFitzWayAmount += detail.ListAmount;
                }

                var halfListAmount = (detail.ListAmount * (decimal).5);
                if (detail.InventoryAmount > halfListAmount)
                {
                    BD1TotalWithInvAmount += 1;
                    BD1TotalMarkup += (detail.ListAmount - detail.InventoryAmount);
                }

                BD1TotalInvAmount += detail.InventoryAmount;
                //BD1TotalFitzWayAmount += detail.ListAmount;
                //BD1TotalMarkup += (detail.ListAmount - detail.InventoryAmount);
            }
            if (BD1TotalCount > 0)
            {
                BD1Day30Percent = (BD1Day30Count / BD1TotalCount);
                BD1Day3060Percent = (BD1Day3060Count / BD1TotalCount);
                BD1Day6090Percent = (BD1Day6090Count / BD1TotalCount);
                BD1Day90Percent = (BD1Day90Count / BD1TotalCount);

            }

            if (BD1TotalWithCost > 0)
            {
                BD1FitzAverage = (BD1TotalFitzWayAmount / BD1TotalWithCost);
            }

            if (BD1TotalWithInvAmount > 0)
            {
                BD1MarkupAverage = (BD1TotalMarkup / BD1TotalWithInvAmount);
                BD1InventoryAverage = (BD1TotalInvAmount / BD1TotalWithInvAmount);
            }

            foreach (var detail in BreakDown1filteredLeadsSold)
            {
                if (detail.WholesaleRetail == "R")
                {
                    BD1TotalFrontEnd += detail.SL_FrontEndProfit;
                    BD1TotalBackEnd += detail.SL_BackEndProfit;
                    BD1TotalAvgProfit += detail.SL_AverageGrossProfit;
                }
                else
                {
                    BD1TotalFrontEnd += detail.FrontEndProfit;
                    BD1TotalBackEnd += detail.BackEndProfit;
                    BD1TotalAvgProfit += detail.AverageGrossProfit;
                }

                var days = Int32.Parse(detail.DaysInStock);
                if (days < 30)
                {
                    BD1Day30SoldCount += 1;
                }
                else if (days >= 30 && days < 60)
                {
                    BD1Day3060SoldCount += 1;
                }
                else if (days >= 60 && days < 90)
                {
                    BD1Day6090SoldCount += 1;
                }
                else if (days >= 90)
                {
                    BD1Day90SoldCount += 1;
                }

                if (detail.TradeCount > 0)
                {
                    BD1TradeCount += detail.TradeCount;
                    BD1TradeDeals += detail.DealNumber + ",";
                }

                BD1TotalSoldAmount += detail.SellingPrice;
                //BD1TotalFitzWaySoldAmount += detail.ListAmount;
                //BD1TotalMarkupSold += (detail.ListAmount - detail.InventoryAmount);
            }
            if (BD1TotalSoldCount > 0)
            {
                BD1Day30SoldPercent = (BD1Day30SoldCount / BD1TotalSoldCount);
                BD1Day3060SoldPercent = (BD1Day3060SoldCount / BD1TotalSoldCount);
                BD1Day6090SoldPercent = (BD1Day6090SoldCount / BD1TotalSoldCount);
                BD1Day90SoldPercent = (BD1Day90SoldCount / BD1TotalSoldCount);
                BD1AvgFrontEnd = (BD1TotalFrontEnd / BD1TotalSoldCount);
                BD1AvgBackEnd = (BD1TotalBackEnd / BD1TotalSoldCount);
                BD1AvgProfit = (BD1TotalAvgProfit / BD1TotalSoldCount);
                BD1TradePercentage = ((decimal)BD1TradeCount / BD1TotalSoldCount);
            }


            decimal BD1DaysSupply = 0;
            decimal BD1SoldLast30 = 0;
            var BD1SupplyOutput = "";

            var soldLast30BD1 = BreakDown1filteredLeadsSold.FindAll(x => x.DealDate > DateTime.Now.AddDays(-31));
            if (soldLast30BD1 != null)
            {
                BD1SoldLast30 = soldLast30BD1.Count;

                if (BD1SoldLast30 != 0)
                {
                    BD1DaysSupply = (30 / BD1SoldLast30) * BD1TotalCount;
                    BD1SupplyOutput = decimal.ToInt32(BD1DaysSupply).ToString();
                }
                else
                {
                    BD1SupplyOutput = "Err";
                }
            }


            var bd1URL = applicationPath + "/Reports/AppraisalReportInvDetails/" + "?bd1=" + Model.BreakDownLevel1 + "," + breakdown1 + "&bd2=" + "&bd3=" + "&bd4=" + "&vs=" + Model.StatusType + "&at=" + Model.AcquisitionType + "&fm=" + Model.StatusOnFM;
            var bd1URLSold = applicationPath + "/Reports/AppraisalReportDetails/" + "?startmonth=" + Model.ReportStartMonth.ToString() + "&startyear=" + Model.ReportStartYear.ToString() + "&endmonth=" + Model.ReportEndMonth.ToString() + "&endyear=" + Model.ReportEndYear.ToString() + "&bd1=" + Model.BreakDownLevel1 + "," + breakdown1 + "&bd2=" + "&bd3=" + "&bd4=" + "&vt=" + Model.VehicleType + "&at=" + Model.AcquisitionType;

            <tr class="location-bd1-data-row-@breakdown1Index @label1.Replace(" ", "-").Replace(".","-").Replace("/","-").Replace("'","-").Replace("*","-").Replace("(","-").Replace(")","-")" data-collapse="location-bd1-collapse-@breakdown1Index">
                <td style="border-bottom:none; padding: 5px 8px;" class="breakdown-column"><a data-toggle="collapse" id="location-bd1-collapse-@breakdown1Index" style="cursor: pointer;" class="location-bd1-collapse-@breakdown1Index-href collapsed" data-target=".location-bd1-collapse-@breakdown1Index">@label1 </a></td>
                <td style="padding: 5px 8px" class="text-center">Inv</td>
                <td style="padding: 5px 8px" class="text-center"><a href="@bd1URL" target="_blank">@BD1TotalCount</a></td>
                <td style="padding: 5px 8px" class="text-center">@BD1SupplyOutput</td>
                 <td style="padding: 5px 8px" class="text-center">@BD1TotalInvAmount.ToString("C", nfi)</td>
                <td style="padding: 5px 8px" class="text-center"><a href="@bd1URL&days=30" target="_blank">@BD1Day30Count</a></td>
                <td style="padding: 5px 8px" class="text-center">@BD1Day30Percent.ToString("P", nfi)</td>
                <td style="padding: 5px 8px" class="text-center"><a href="@bd1URL&days=3060" target="_blank">@BD1Day3060Count</a></td>
                <td style="padding: 5px 8px" class="text-center">@BD1Day3060Percent.ToString("P", nfi)</td>
                <td style="padding: 5px 8px" class="text-center"><a href="@bd1URL&days=6090" target="_blank">@BD1Day6090Count</a></td>
                <td style="padding: 5px 8px" class="text-center">@BD1Day6090Percent.ToString("P", nfi)</td>
                <td style="padding: 5px 8px" class="text-center"><a href="@bd1URL&days=90" target="_blank">@BD1Day90Count</a></td>
                <td style="padding: 5px 8px" class="text-center">@BD1Day90Percent.ToString("P", nfi)</td>
                <td style="padding: 5px 8px" class="text-center">@BD1FitzAverage.ToString("C", nfi)</td>
                <td style="padding: 5px 8px" class="text-center">@BD1InventoryAverage.ToString("C", nfi)</td>
                <td style="padding: 5px 8px" class="text-center">@BD1MarkupAverage.ToString("C", nfi)</td>
                <td style="padding: 5px 8px" class="text-center"></td>
                <td style="padding: 5px 8px" class="text-center"></td>
                <td style="padding: 5px 8px" class="text-center"></td>
            </tr>
            <tr class="@label1.Replace(" ", "-").Replace(".","-").Replace("/","-").Replace("'","-").Replace("*","-").Replace("(","-").Replace(")","-")">
                <td style="border-top:none; border-bottom-width:2px; padding: 5px 8px" class="breakdown-column"></td>
                <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">Sold</td>
                <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center"><a href="@bd1URLSold" target="_blank">@BD1TotalSoldCount</a></td>
                
                @using (Html.BeginForm("AppraisalReportTradeDetails", "Reports", FormMethod.Post, new { target = "_blank", name = "BD1Form" + breakdown1Index, id = "BD1Form" + breakdown1Index }))
                {
                    @Html.Hidden("tradeDeals", BD1TradeDeals);
                    @Html.Hidden("bd1", Model.BreakDownLevel1 + "," + breakdown1);
                    @Html.Hidden("bd2", "");
                    @Html.Hidden("bd3", "");
                    @Html.Hidden("bd4", "");

                    @Html.Hidden("startmonth", Model.ReportStartMonth.ToString());
                    @Html.Hidden("startyear", Model.ReportStartYear.ToString());
                    @Html.Hidden("endmonth", Model.ReportEndMonth.ToString());
                    @Html.Hidden("endyear", Model.ReportEndYear.ToString());
                    @Html.Hidden("vt", Model.VehicleType);
                    @Html.Hidden("at", Model.AcquisitionType);

                    <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">
                        <a href="javascript:$('@Html.Raw("#BD1Form" + breakdown1Index)').submit()">@BD1TradeCount</a> (@BD1TradePercentage.ToString("P", nfi))
                    </td>
                }
                               
                <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">@BD1TotalSoldAmount.ToString("C", nfi)</td>
                <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center"><a href="@bd1URLSold&days=30" target="_blank">@BD1Day30SoldCount</a></td>
                <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">@BD1Day30SoldPercent.ToString("P", nfi)</td>
                <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center"><a href="@bd1URLSold&days=3060" target="_blank">@BD1Day3060SoldCount</a></td>
                <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">@BD1Day3060SoldPercent.ToString("P", nfi)</td>
                <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center"><a href="@bd1URLSold&days=6090" target="_blank">@BD1Day6090SoldCount</a></td>
                <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">@BD1Day6090SoldPercent.ToString("P", nfi)</td>
                <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center"><a href="@bd1URLSold&days=90" target="_blank">@BD1Day90SoldCount</a></td>
                <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">@BD1Day90SoldPercent.ToString("P", nfi)</td>
                <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center"></td>
                <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center"></td>
                <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center"></td>
                <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">@BD1AvgFrontEnd.ToString("C", nfi)</td>
                <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">@BD1AvgBackEnd.ToString("C", nfi)</td>
                <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">@BD1AvgProfit.ToString("C", nfi)</td>
            </tr>

                            <script type="text/javascript">
                                $("#filterBreakdown1").append("<option value='" + "@label1" + "'>" + "@label1" + "</option>");

                                $(document).ready(function () {
                                    $(".location-bd1-collapse-@breakdown1Index-href").click(function () {
                                        $('.location-bd1-data-row-@breakdown1Index').toggleClass('selected-row');
                                        $(".location-bd1-collapse-@breakdown1Index-href").toggleClass('changed');
                                    });
                                });
                            </script>

            var breakdownLevel2Values = new List<string>();

            switch (Model.BreakDownLevel2)
            {
                //breakdownLevel2Values = BreakDown1filteredLeads.Select(x => x.Appraiser).Distinct().OrderBy(x => x).ToList();
                case "appraiser":
                    var tempAppraiserValues = new List<string>();
                    tempAppraiserValues = BreakDown1filteredLeadsSold.Select(x => x.Appraiser).Distinct().OrderBy(x => x).ToList();
                    tempAppraiserValues.AddRange(BreakDown1filteredLeads.Select(x => x.Appraiser).Distinct().OrderBy(x => x).ToList());

                    breakdownLevel2Values = tempAppraiserValues.Distinct().OrderBy(x => x).ToList();
                    break;

                case "certified":
                    //var tempCertifiedValues = new List<string>();

                    ////tempCertifiedValues = BreakDown1filteredLeadsSold.Select(x => x.Certification.Trim()).Distinct().OrderBy(x => x).ToList();
                    //tempCertifiedValues.AddRange(BreakDown1filteredLeads.Select(x => x.Certification.Trim()).Distinct().OrderBy(x => x).ToList());

                    //breakdownLevel2Values = tempCertifiedValues.Distinct().OrderBy(x => x).ToList();

                    breakdownLevel2Values.Add("FitzWay Value");
                    breakdownLevel2Values.Add("FitzWay Plus");
                    breakdownLevel2Values.Add("FitzWay Certified");
                    breakdownLevel2Values.Add("FitzWay Handyman");
                    breakdownLevel2Values.Add("Manufacturer CPO");
                    breakdownLevel2Values.Add("Other");

                    break;

                case "days":
                    breakdownLevel2Values.Add("30");
                    breakdownLevel2Values.Add("60");
                    breakdownLevel2Values.Add("90");
                    breakdownLevel2Values.Add("120");
                    break;

                case "soldloc":
                    var tempLocValues = new List<string>();

                    tempLocValues = BreakDown1filteredLeadsSold.Select(x => x.SoldLocation).Distinct().OrderBy(x => x).ToList();
                    tempLocValues.AddRange(BreakDown1filteredLeads.Select(x => x.DRloc.ToUpper()).Distinct().OrderBy(x => x).ToList());

                    breakdownLevel2Values = tempLocValues.Distinct().OrderBy(x => x).ToList();

                    if (breakdownLevel2Values.Contains("FAM") && breakdownLevel2Values.Contains("FCG"))
                    {
                        breakdownLevel2Values.Remove("FCG");
                    }

                    if (breakdownLevel2Values.Contains("FTN") && breakdownLevel2Values.Contains("FTO"))
                    {
                        breakdownLevel2Values.Remove("FTO");
                    }

                    break;

                case "make":
                    var tempMakeValues = new List<string>();

                    tempMakeValues = BreakDown1filteredLeadsSold.Where(x => !x.Make.Contains("Used")).Select(x => x.Make).Distinct().OrderBy(x => x).ToList();
                    tempMakeValues.AddRange(BreakDown1filteredLeads.Where(x => !x.Make.Contains("Used")).Select(x => x.Make.ToUpper()).Distinct().OrderBy(x => x).ToList());

                    breakdownLevel2Values = tempMakeValues.Distinct().OrderBy(x => x).ToList();
                    break;

                case "mileage":
                    breakdownLevel2Values.Add("25000");
                    breakdownLevel2Values.Add("50000");
                    breakdownLevel2Values.Add("75000");
                    breakdownLevel2Values.Add("100000");
                    breakdownLevel2Values.Add("500000");
                    break;

                case "model":
                    var tempModelValues = new List<string>();

                    tempModelValues = BreakDown1filteredLeadsSold.Select(x => x.Model).Distinct().OrderBy(x => x).ToList();
                    tempModelValues.AddRange(BreakDown1filteredLeads.Select(x => x.Carline).Distinct().OrderBy(x => x).ToList());

                    breakdownLevel2Values = tempModelValues.Distinct().OrderBy(x => x).ToList();
                    break;

                case "modelyear":
                    var tempYearValues = new List<string>();

                    tempYearValues = BreakDown1filteredLeadsSold.Select(x => x.Year).Distinct().OrderBy(x => x).ToList();
                    tempYearValues.AddRange(BreakDown1filteredLeads.Select(x => x.Year).Distinct().OrderBy(x => x).ToList());

                    breakdownLevel2Values = tempYearValues.Distinct().OrderBy(x => x).ToList();
                    break;

                case "monthyear":
                    var tempMonthYearValues = new List<string>();

                    var monthYears = BreakDown1filteredLeads.Select(x => x.LastModifiedDate.ToString("MM/yyyy")).Distinct().OrderBy(x => Convert.ToDateTime(x)).ToList();
                    tempMonthYearValues = monthYears.Distinct().OrderBy(x => Convert.ToDateTime(x)).ToList();

                    var monthYearsSold = BreakDown1filteredLeadsSold.Select(x => x.DealMonthYear.ToString("MM/yyyy")).Distinct().OrderBy(x => Convert.ToDateTime(x)).ToList();
                    tempMonthYearValues.AddRange(monthYearsSold.Distinct().OrderBy(x => Convert.ToDateTime(x)).ToList());

                    breakdownLevel2Values = tempMonthYearValues.Distinct().OrderBy(x => x).ToList();
                    break;

                //case "associate":
                //    breakdownLevel2Values = BreakDown1filteredLeadsSold.Select(x => x.SalesAssociate).Distinct().OrderBy(x => x).ToList();
                //    break;

                case "price":
                    breakdownLevel2Values.Add("10000");
                    breakdownLevel2Values.Add("20000");
                    breakdownLevel2Values.Add("30000");
                    breakdownLevel2Values.Add("40000");
                    breakdownLevel2Values.Add("50000");
                    breakdownLevel2Values.Add("60000");
                    breakdownLevel2Values.Add("70000");
                    breakdownLevel2Values.Add("80000");
                    breakdownLevel2Values.Add("90000");
                    breakdownLevel2Values.Add("100000");
                    breakdownLevel2Values.Add("200000");
                    break;

                case "showroom":
                    var tempShowroomValues = new List<string>();


                    //tempShowroomValues = BreakDown1filteredLeadsSold.Select(x => x.Showroom).Distinct().OrderBy(x => x).ToList();

                    tempShowroomValues.AddRange(BreakDown1filteredLeads.Select(x => x.Loc.ToUpper()).Distinct().OrderBy(x => x).ToList());

                    breakdownLevel2Values = tempShowroomValues.Distinct().OrderBy(x => x).ToList();
                    break;

                //case "stock":
                //    var tempStockValues = new List<string>();

                //    tempStockValues = BreakDown1filteredLeadsSold.Select(x => x.StockNumber).Distinct().OrderBy(x => x).ToList();
                //    tempStockValues.AddRange(BreakDown1filteredLeads.Select(x => x.StockNumber).Distinct().OrderBy(x => x).ToList());

                //    breakdownLevel2Values = tempStockValues.Distinct().OrderBy(x => x).ToList();
                //    break;

                case "vehiclesource":
                    var tempSourceValues = new List<string>();

                    tempSourceValues = BreakDown1filteredLeadsSold.Select(x => x.VehicleSource).Distinct().OrderBy(x => x).ToList();
                    tempSourceValues.AddRange(BreakDown1filteredLeads.Select(x => x.VehicleSource).Distinct().OrderBy(x => x).ToList());

                    breakdownLevel2Values = tempSourceValues.Distinct().OrderBy(x => x).ToList();
                    break;

                //case "zipcode":
                //    breakdownLevel2Values = BreakDown1filteredLeadsSold.Select(x => x.ZipCode).Distinct().OrderBy(x => x).ToList();
                //    break;



                default:
                    // breakdownLevel2Values = Model.AssociateLeads.Select(x => x.DealerId.ToString()).Distinct().OrderBy(x => x).ToList();
                    break;

            }

            foreach (var breakdown2 in breakdownLevel2Values)
            {

                var label2 = breakdown2;

                var BreakDown2filteredLeads = new List<SalesCommission.Models.TradeAcquisitionDetail>();
                var BreakDown2filteredLeadsSold = new List<SalesCommission.Models.AppraisalSoldDetail>();


                switch (Model.BreakDownLevel2)
                {
                    //BreakDown2filteredLeads = BreakDown1filteredLeads.FindAll(x => x.Appraiser == breakdown2);
                    case "appraiser":
                        BreakDown2filteredLeads = BreakDown1filteredLeads.FindAll(x => x.Appraiser == breakdown2);
                        BreakDown2filteredLeadsSold = BreakDown1filteredLeadsSold.FindAll(x => x.Appraiser == breakdown2);
                        break;

                    case "certified":

                        switch (breakdown2)
                        {
                            case "FitzWay Value":
                                BreakDown2filteredLeads = BreakDown1filteredLeads.FindAll(x => x.Certification.Trim() == "F915");
                                BreakDown2filteredLeadsSold = BreakDown1filteredLeadsSold.FindAll(x => x.Certification.Trim() == "FW");
                                break;
                            case "FitzWay Plus":
                                BreakDown2filteredLeads = BreakDown1filteredLeads.FindAll(x => x.Certification.Trim() == "F914");
                                BreakDown2filteredLeadsSold = BreakDown1filteredLeadsSold.FindAll(x => x.Certification.Trim() == "FP");
                                break;
                            case "FitzWay Certified":
                                BreakDown2filteredLeads = BreakDown1filteredLeads.FindAll(x => x.Certification.Trim() == "F910");
                                BreakDown2filteredLeadsSold = BreakDown1filteredLeadsSold.FindAll(x => x.Certification.Trim() == "FC");
                                break;
                            case "FitzWay Handyman":
                                BreakDown2filteredLeads = BreakDown1filteredLeads.FindAll(x => x.Certification.Trim() == "F916" || x.Certification.Trim() == "F917" || x.Certification.Trim() == "F918");
                                BreakDown2filteredLeadsSold = BreakDown1filteredLeadsSold.FindAll(x => x.Certification.Trim() == "HDM");
                                break;
                            case "Manufacturer CPO":
                                BreakDown2filteredLeads = BreakDown1filteredLeads.FindAll(x => x.Certification.Trim() == "F906" || x.Certification.Trim() == "F907" || x.Certification.Trim() == "F908" || x.Certification.Trim() == "F909" || x.Certification.Trim() == "F911" || x.Certification.Trim() == "F912" || x.Certification.Trim() == "F913" || x.Certification.Trim() == "F922" || x.Certification.Trim() == "F923");
                                BreakDown2filteredLeadsSold = BreakDown1filteredLeadsSold.FindAll(x => x.Certification.Trim() == "MC" || x.Certification.Trim() == "CUV" || x.Certification.Trim() == "MZC" || x.Certification.Trim() == "GMU" || x.Certification.Trim() == "VWC" || x.Certification.Trim() == "CPO");
                                break;
                            case "Other":
                                BreakDown2filteredLeads = BreakDown1filteredLeads.FindAll(x => x.Certification.Trim() == "");
                                BreakDown2filteredLeadsSold = BreakDown1filteredLeadsSold.FindAll(x => x.Certification.Trim() == "");
                                break;

                        }

                        break;

                    case "days":
                        var daysbreakdown = Convert.ToDecimal(breakdown2);

                        if (daysbreakdown == 120)
                        {
                            BreakDown2filteredLeads = BreakDown1filteredLeads.FindAll(x => Convert.ToDecimal(x.Days) >= 90);
                            BreakDown2filteredLeadsSold = BreakDown1filteredLeadsSold.FindAll(x => Convert.ToDecimal(Convert.ToDecimal(x.DaysInStock)) >= 90);
                            label2 = "> 90";
                        }
                        else
                        {
                            BreakDown2filteredLeads = BreakDown1filteredLeads.FindAll(x => Convert.ToDecimal(x.Days) < daysbreakdown && Convert.ToDecimal(x.Days) >= (daysbreakdown - 30));
                            BreakDown2filteredLeadsSold = BreakDown1filteredLeadsSold.FindAll(x => Convert.ToDecimal(x.DaysInStock) < daysbreakdown && Convert.ToDecimal(x.DaysInStock) >= (daysbreakdown - 30));
                            label2 = (daysbreakdown - 30) + " - " + (daysbreakdown - 1);
                        }
                        break;


                    case "soldloc":

                        if (breakdown2 == "FAM")
                        {
                            BreakDown2filteredLeads = BreakDown1filteredLeads.FindAll(x => x.DRloc == "FCG");
                            BreakDown2filteredLeadsSold = BreakDown1filteredLeadsSold.FindAll(x => x.SoldLocation == "FAM");
                        }
                        else if (breakdown2 == "FTN")
                        {
                            BreakDown2filteredLeads = BreakDown1filteredLeads.FindAll(x => x.DRloc == "FTO");
                            BreakDown2filteredLeadsSold = BreakDown1filteredLeadsSold.FindAll(x => x.SoldLocation == "FTN");
                        }
                        else
                        {
                            BreakDown2filteredLeads = BreakDown1filteredLeads.FindAll(x => x.DRloc == breakdown2);
                            BreakDown2filteredLeadsSold = BreakDown1filteredLeadsSold.FindAll(x => x.SoldLocation == breakdown2);
                        }



                        foreach (var store in SalesCommission.Business.Enums.SoldLocations)
                        {
                            if (store.LocationId.ToLower().Trim() == breakdown2.ToLower().Trim())
                            {
                                label2 = store.Name;
                            }
                        }

                        break;

                    case "make":
                        BreakDown2filteredLeads = BreakDown1filteredLeads.FindAll(x => x.Make.ToUpper() == breakdown2);
                        BreakDown2filteredLeadsSold = BreakDown1filteredLeadsSold.FindAll(x => x.Make.ToUpper() == breakdown2);
                        break;

                    case "mileage":
                        var milesbreakdown = Convert.ToDecimal(breakdown2);

                        if (milesbreakdown == 500000)
                        {
                            BreakDown2filteredLeads = BreakDown1filteredLeads.FindAll(x => Convert.ToDecimal(x.Miles) >= 100000);
                            BreakDown2filteredLeadsSold = BreakDown1filteredLeadsSold.FindAll(x => Convert.ToDecimal(x.Miles) >= 100000);
                            label2 = "> 100000";
                        }
                        else
                        {
                            BreakDown2filteredLeads = BreakDown1filteredLeads.FindAll(x => Convert.ToDecimal(x.Miles) < milesbreakdown && Convert.ToDecimal(x.Miles) >= (milesbreakdown - 25000));
                            BreakDown2filteredLeadsSold = BreakDown1filteredLeadsSold.FindAll(x => Convert.ToDecimal(x.Miles) < milesbreakdown && Convert.ToDecimal(x.Miles) >= (milesbreakdown - 25000));
                            label2 = (milesbreakdown - 25000) + " - " + (milesbreakdown - 1);
                        }
                        break;

                    case "model":
                        BreakDown2filteredLeads = BreakDown1filteredLeads.FindAll(x => x.Carline == breakdown2);
                        BreakDown2filteredLeadsSold = BreakDown1filteredLeadsSold.FindAll(x => x.Model == breakdown2);
                        break;

                    case "modelyear":
                        BreakDown2filteredLeads = BreakDown1filteredLeads.FindAll(x => x.Year == breakdown2);
                        BreakDown2filteredLeadsSold = BreakDown1filteredLeadsSold.FindAll(x => x.Year == breakdown2);
                        break;

                    case "monthyear":
                        BreakDown2filteredLeads = BreakDown1filteredLeads.FindAll(x => x.LastModifiedDate.ToString("MM/yyyy") == breakdown2);
                        BreakDown2filteredLeadsSold = BreakDown1filteredLeadsSold.FindAll(x => x.DealMonthYear.ToString("MM/yyyy") == breakdown2);
                        var dealDate = Convert.ToDateTime(breakdown1);
                        label2 = dealDate.Month + "/" + dealDate.Year;

                        break;

                    //case "associate":
                    //    BreakDown1filteredLeads = BreakDown1filteredLeads.FindAll(x => x.Year == breakdown2);
                    //    BreakDown1filteredLeadsSold = BreakDown1filteredLeadsSold.FindAll(x => x.Year == breakdown2);
                    //    break;

                    case "price":
                        var pricebreakdown = Convert.ToDecimal(breakdown2);

                        if (pricebreakdown == 200000)
                        {
                            BreakDown2filteredLeads = BreakDown1filteredLeads.FindAll(x => x.ListAmount >= 100000);
                            BreakDown2filteredLeadsSold = BreakDown1filteredLeadsSold.FindAll(x => x.SellingPrice >= 100000);
                            label2 = "> 100000";
                        }
                        else
                        {
                            BreakDown2filteredLeads = BreakDown1filteredLeads.FindAll(x => x.ListAmount < pricebreakdown && x.ListAmount >= (pricebreakdown - 10000));
                            BreakDown2filteredLeadsSold = BreakDown1filteredLeadsSold.FindAll(x => x.SellingPrice < pricebreakdown && x.SellingPrice >= (pricebreakdown - 10000));
                            label2 = (pricebreakdown - 10000) + " - " + (pricebreakdown - 1);
                        }
                        break;

                    case "showroom":
                        BreakDown2filteredLeads = BreakDown1filteredLeads.FindAll(x => x.Loc == breakdown2);

                        var soldBreakdown = "";

                        foreach (var mapping in SalesCommission.Business.Enums.ShowroomIDMapping)
                        {
                            if (mapping.Name == breakdown2)
                            {
                                soldBreakdown = mapping.LocationId;
                                break;
                            }
                        }

                        BreakDown2filteredLeadsSold = BreakDown1filteredLeadsSold.FindAll(x => x.Showroom == soldBreakdown);

                        foreach (var store in SalesCommission.Business.Enums.AppraisalLocations)
                        {
                            if (store.LocationId.ToLower().Trim() == breakdown2.ToLower().Trim())
                            {
                                label2 = store.Name;
                            }
                        }

                        break;

                    //case "stock":
                    //    BreakDown1filteredLeads = BreakDown1filteredLeads.FindAll(x => x.StockNumber == breakdown2);
                    //    BreakDown1filteredLeadsSold = BreakDown1filteredLeadsSold.FindAll(x => x.StockNumber == breakdown2);
                    //    break;

                    case "vehiclesource":
                        BreakDown2filteredLeads = BreakDown1filteredLeads.FindAll(x => x.VehicleSource == breakdown2);
                        BreakDown2filteredLeadsSold = BreakDown1filteredLeadsSold.FindAll(x => x.VehicleSource == breakdown2);
                        break;

                    default:
                        BreakDown2filteredLeads = BreakDown1filteredLeads.FindAll(x => x.Loc == breakdown2);
                        break;

                }


                var BD2TotalCount = BreakDown2filteredLeads.Count;
                var BD2TotalSoldCount = BreakDown2filteredLeadsSold.Count;

                decimal BD2TotalInvAmount = 0;
                decimal BD2TotalFitzWayAmount = 0;
                decimal BD2TotalMarkup = 0;

                decimal BD2Day30Count = 0;
                decimal BD2Day3060Count = 0;
                decimal BD2Day6090Count = 0;
                decimal BD2Day90Count = 0;

                decimal BD2Day30Percent = 0;
                decimal BD2Day3060Percent = 0;
                decimal BD2Day6090Percent = 0;
                decimal BD2Day90Percent = 0;

                decimal BD2TotalSoldAmount = 0;
                decimal BD2TotalFitzWaySoldAmount = 0;
                decimal BD2TotalMarkupSold = 0;

                decimal BD2Day30SoldCount = 0;
                decimal BD2Day3060SoldCount = 0;
                decimal BD2Day6090SoldCount = 0;
                decimal BD2Day90SoldCount = 0;

                decimal BD2Day30SoldPercent = 0;
                decimal BD2Day3060SoldPercent = 0;
                decimal BD2Day6090SoldPercent = 0;
                decimal BD2Day90SoldPercent = 0;

                decimal BD2TotalFrontEnd = 0;
                decimal BD2TotalBackEnd = 0;
                decimal BD2TotalAvgProfit = 0;
                decimal BD2AvgFrontEnd = 0;
                decimal BD2AvgBackEnd = 0;
                decimal BD2AvgProfit = 0;

                string BD2TradeDeals = "";
                var BD2TotalWithCost = 0;
                var BD2TotalWithInvAmount = 0;

                decimal BD2MarkupAverage = 0;
                decimal BD2FitzAverage = 0;
                decimal BD2InventoryAverage = 0;

                int BD2TradeCount = 0;
                decimal BD2TradePercentage = 0;

                foreach (var detail in BreakDown2filteredLeads)
                {
                    var days = Int32.Parse(detail.Days);
                    if (days < 30)
                    {
                        BD2Day30Count += 1;
                    }
                    else if (days >= 30 && days < 60)
                    {
                        BD2Day3060Count += 1;
                    }
                    else if (days >= 60 && days < 90)
                    {
                        BD2Day6090Count += 1;
                    }
                    else if (days >= 90)
                    {
                        BD2Day90Count += 1;
                    }


                    if (detail.ListAmount > 0)
                    {
                        BD2TotalWithCost += 1;
                        BD2TotalFitzWayAmount += detail.ListAmount;
                    }

                    var halfListAmount = (detail.ListAmount * (decimal).5);
                    if (detail.InventoryAmount > halfListAmount)
                    {
                        BD2TotalWithInvAmount += 1;
                        BD2TotalMarkup += (detail.ListAmount - detail.InventoryAmount);
                    }

                    BD2TotalInvAmount += detail.InventoryAmount;
                    //BD2TotalFitzWayAmount += detail.ListAmount;
                    //BD2TotalMarkup += (detail.ListAmount - detail.InventoryAmount);
                }
                if (BD2TotalCount > 0)
                {
                    BD2Day30Percent = (BD2Day30Count / BD2TotalCount);
                    BD2Day3060Percent = (BD2Day3060Count / BD2TotalCount);
                    BD2Day6090Percent = (BD2Day6090Count / BD2TotalCount);
                    BD2Day90Percent = (BD2Day90Count / BD2TotalCount);

                }

                if (BD2TotalWithCost > 0)
                {
                    BD2FitzAverage = (BD2TotalFitzWayAmount / BD2TotalWithCost);
                }

                if (BD2TotalWithInvAmount > 0)
                {
                    BD2MarkupAverage = (BD2TotalMarkup / BD2TotalWithInvAmount);
                    BD2InventoryAverage = (BD2TotalInvAmount / BD2TotalWithInvAmount);
                }


                foreach (var detail in BreakDown2filteredLeadsSold)
                {
                    if (detail.WholesaleRetail == "R")
                    {
                        BD2TotalFrontEnd += detail.SL_FrontEndProfit;
                        BD2TotalBackEnd += detail.SL_BackEndProfit;
                        BD2TotalAvgProfit += detail.SL_AverageGrossProfit;
                    }
                    else
                    {
                        BD2TotalFrontEnd += detail.FrontEndProfit;
                        BD2TotalBackEnd += detail.BackEndProfit;
                        BD2TotalAvgProfit += detail.AverageGrossProfit;
                    }

                    var days = Int32.Parse(detail.DaysInStock);
                    if (days < 30)
                    {
                        BD2Day30SoldCount += 1;
                    }
                    else if (days >= 30 && days < 60)
                    {
                        BD2Day3060SoldCount += 1;
                    }
                    else if (days >= 60 && days < 90)
                    {
                        BD2Day6090SoldCount += 1;
                    }
                    else if (days >= 90)
                    {
                        BD2Day90SoldCount += 1;
                    }


                    if (detail.TradeCount > 0)
                    {
                        BD2TradeCount += detail.TradeCount;
                        BD2TradeDeals += detail.DealNumber + ",";
                    }

                    BD2TotalSoldAmount += detail.SellingPrice;
                    //BD2TotalFitzWaySoldAmount += detail.ListAmount;
                    //BD2TotalMarkupSold += (detail.ListAmount - detail.InventoryAmount);
                }
                if (BD2TotalSoldCount > 0)
                {
                    BD2Day30SoldPercent = (BD2Day30SoldCount / BD2TotalSoldCount);
                    BD2Day3060SoldPercent = (BD2Day3060SoldCount / BD2TotalSoldCount);
                    BD2Day6090SoldPercent = (BD2Day6090SoldCount / BD2TotalSoldCount);
                    BD2Day90SoldPercent = (BD2Day90SoldCount / BD2TotalSoldCount);
                    BD2AvgFrontEnd = (BD2TotalFrontEnd / BD2TotalSoldCount);
                    BD2AvgBackEnd = (BD2TotalBackEnd / BD2TotalSoldCount);
                    BD2AvgProfit = (BD2TotalAvgProfit / BD2TotalSoldCount);
                    BD2TradePercentage = ((decimal)BD2TradeCount / BD2TotalSoldCount);
                }


                decimal BD2DaysSupply = 0;
                decimal BD2SoldLast30 = 0;

                var BD2SupplyOutput = "";

                var soldLast30BD2 = BreakDown2filteredLeadsSold.FindAll(x => x.DealDate > DateTime.Now.AddDays(-31));
                if (soldLast30BD2 != null)
                {
                    BD2SoldLast30 = soldLast30BD2.Count;

                    if (BD2SoldLast30 != 0)
                    {
                        BD2DaysSupply = (30 / BD2SoldLast30) * BD2TotalCount;
                        BD2SupplyOutput = decimal.ToInt32(BD2DaysSupply).ToString();
                    }
                    else
                    {
                        BD2SupplyOutput = "Err";
                    }
                }


                var bd2URL = applicationPath + "/Reports/AppraisalReportInvDetails/" + "?bd1=" + Model.BreakDownLevel1 + "," + breakdown1 + "&bd2=" + Model.BreakDownLevel2 + "," + breakdown2 + "&bd3=" + "&bd4=" + "&vs=" + Model.StatusType + "&at=" + Model.AcquisitionType + "&fm=" + Model.StatusOnFM;
                var bd2URLSold = applicationPath + "/Reports/AppraisalReportDetails/" + "?startmonth=" + Model.ReportStartMonth.ToString() + "&startyear=" + Model.ReportStartYear.ToString() + "&endmonth=" + Model.ReportEndMonth.ToString() + "&endyear=" + Model.ReportEndYear.ToString() + "&bd1=" + Model.BreakDownLevel1 + "," + breakdown1 + "&bd2=" + Model.BreakDownLevel2 + "," + breakdown2 + "&bd3=" + "&bd4=" + "&vt=" + Model.VehicleType + "&at=" + Model.AcquisitionType;

                <tr class="location-bd1-collapse-@breakdown1Index collapse out location-bd2-data-row-@breakdown2Index @label2.Replace(" ", "-").Replace(".","-").Replace("/","-").Replace("'","-").Replace("*","-").Replace("(","-").Replace(")","-")" data-collapse="location-bd2-collapse-@breakdown2Index">

                    <td style="padding: 5px 8px"  class="indent-td2"><a data-toggle="collapse" id="location-bd2-collapse-@breakdown2Index" style="cursor: pointer;" class="location-bd2-collapse-@breakdown2Index-href collapsed indent-2" data-target=".location-bd2-collapse-@breakdown2Index">@label2 </a></td>
                    <td style="padding: 5px 8px" class="text-center">Inv</td>
                    <td style="padding: 5px 8px" class="text-center"><a href="@bd2URL" target="_blank">@BD2TotalCount</a></td>
                    <td style="padding: 5px 8px" class="text-center">@BD2SupplyOutput</td>
                    <td style="padding: 5px 8px" class="text-center">@BD2TotalInvAmount.ToString("C", nfi)</td>
                    <td style="padding: 5px 8px" class="text-center"><a href="@bd2URL&days=30" target="_blank">@BD2Day30Count</a></td>
                    <td style="padding: 5px 8px" class="text-center">@BD2Day30Percent.ToString("P", nfi)</td>
                    <td style="padding: 5px 8px" class="text-center"><a href="@bd2URL&days=3060" target="_blank">@BD2Day3060Count</a></td>
                    <td style="padding: 5px 8px" class="text-center">@BD2Day3060Percent.ToString("P", nfi)</td>
                    <td style="padding: 5px 8px" class="text-center"><a href="@bd2URL&days=6090" target="_blank">@BD2Day6090Count</a></td>
                    <td style="padding: 5px 8px" class="text-center">@BD2Day6090Percent.ToString("P", nfi)</td>
                    <td style="padding: 5px 8px" class="text-center"><a href="@bd2URL&days=90" target="_blank">@BD2Day90Count</a></td>
                    <td style="padding: 5px 8px" class="text-center">@BD2Day90Percent.ToString("P", nfi)</td>
                    <td style="padding: 5px 8px" class="text-center">@BD2FitzAverage.ToString("C", nfi)</td>
                    <td style="padding: 5px 8px" class="text-center">@BD2InventoryAverage.ToString("C", nfi)</td>
                    <td style="padding: 5px 8px" class="text-center">@BD2MarkupAverage.ToString("C", nfi)</td>
                    <td style="padding: 5px 8px" class="text-center"></td>
                    <td style="padding: 5px 8px" class="text-center"></td>
                    <td style="padding: 5px 8px" class="text-center"></td>
                </tr>
                <tr class="location-bd1-collapse-@breakdown1Index collapse out @label2.Replace(" ", "-").Replace(".","-").Replace("/","-").Replace("'","-").Replace("*","-").Replace("(","-").Replace(")","-")">
                    <td style="border-top:none; border-bottom-width:2px; padding: 5px 8px" class="indent-td2">&nbsp;</td>
                    <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">Sold</td>
                    <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center"><a href="@bd2URLSold" target="_blank">@BD2TotalSoldCount</a></td>
                    
                    @using (Html.BeginForm("AppraisalReportTradeDetails", "Reports", FormMethod.Post, new { target = "_blank", name = "BD2Form" + breakdown2Index, id = "BD2Form" + breakdown2Index }))
                    {
                        @Html.Hidden("tradeDeals", BD2TradeDeals);
                        @Html.Hidden("bd1", Model.BreakDownLevel1 + "," + breakdown1);
                        @Html.Hidden("bd2", Model.BreakDownLevel2 + "," + breakdown2);
                        @Html.Hidden("bd3", "");
                        @Html.Hidden("bd4", "");

                        @Html.Hidden("startmonth", Model.ReportStartMonth.ToString());
                        @Html.Hidden("startyear", Model.ReportStartYear.ToString());
                        @Html.Hidden("endmonth", Model.ReportEndMonth.ToString());
                        @Html.Hidden("endyear", Model.ReportEndYear.ToString());
                        @Html.Hidden("vt", Model.VehicleType);
                        @Html.Hidden("at", Model.AcquisitionType);

                        <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">
                            <a href="javascript:$('@Html.Raw("#BD2Form" + breakdown2Index)').submit()">@BD2TradeCount</a> (@BD2TradePercentage.ToString("P", nfi))
                        </td>
                    }
 
                    <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">@BD2TotalSoldAmount.ToString("C", nfi)</td>
                    <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center"><a href="@bd2URLSold&days=30" target="_blank">@BD2Day30SoldCount</a></td>
                    <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">@BD2Day30SoldPercent.ToString("P", nfi)</td>
                    <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center"><a href="@bd2URLSold&days=3060" target="_blank">@BD2Day3060SoldCount</a></td>
                    <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">@BD2Day3060SoldPercent.ToString("P", nfi)</td>
                    <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center"><a href="@bd2URLSold&days=6090" target="_blank">@BD2Day6090SoldCount</a></td>
                    <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">@BD2Day6090SoldPercent.ToString("P", nfi)</td>
                    <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center"><a href="@bd2URLSold&days=90" target="_blank">@BD2Day90SoldCount</a></td>
                    <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">@BD2Day90SoldPercent.ToString("P", nfi)</td>
                    <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center"></td>
                    <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center"></td>
                    <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center"></td>
                    <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">@BD2AvgFrontEnd.ToString("C", nfi)</td>
                    <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">@BD2AvgBackEnd.ToString("C", nfi)</td>
                    <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">@BD2AvgProfit.ToString("C", nfi)</td>
                </tr>

                                <script type="text/javascript">

                                    var bAdd = true;
                                    $("#filterBreakdown2 option").each(function () {
                                        if ($(this).attr('value') == '@label2') {
                                            bAdd = false;
                                        }
                                    });

                                    if (bAdd == true) {
                                        $("#filterBreakdown2").append("<option value='" + "@label2" + "'>" + "@label2" + "</option>");
                                    }

                                    $(document).ready(function () {
                                        $(".location-bd2-collapse-@breakdown2Index-href").click(function () {
                                            $('.location-bd2-data-row-@breakdown2Index').toggleClass('selected-row');
                                            $(".location-bd2-collapse-@breakdown2Index-href").toggleClass('changed');
                                        });
                                    });
                                </script>

                var breakdownLevel3Values = new List<string>();

                switch (Model.BreakDownLevel3)
                {
                    case "appraiser":
                        var tempAppraiserValues = new List<string>();
                        tempAppraiserValues = BreakDown2filteredLeadsSold.Select(x => x.Appraiser).Distinct().OrderBy(x => x).ToList();
                        tempAppraiserValues.AddRange(BreakDown2filteredLeads.Select(x => x.Appraiser).Distinct().OrderBy(x => x).ToList());

                        breakdownLevel3Values = tempAppraiserValues.Distinct().OrderBy(x => x).ToList();
                        break;

                    case "certified":
                        //var tempCertifiedValues = new List<string>();

                        ////tempCertifiedValues = BreakDown2filteredLeadsSold.Select(x => x.Certification.Trim()).Distinct().OrderBy(x => x).ToList();
                        //tempCertifiedValues.AddRange(BreakDown2filteredLeads.Select(x => x.Certification.Trim()).Distinct().OrderBy(x => x).ToList());

                        //breakdownLevel3Values = tempCertifiedValues.Distinct().OrderBy(x => x).ToList();

                        breakdownLevel3Values.Add("FitzWay Value");
                        breakdownLevel3Values.Add("FitzWay Plus");
                        breakdownLevel3Values.Add("FitzWay Certified");
                        breakdownLevel3Values.Add("FitzWay Handyman");
                        breakdownLevel3Values.Add("Manufacturer CPO");
                        breakdownLevel3Values.Add("Other");

                        break;

                    case "days":
                        breakdownLevel3Values.Add("30");
                        breakdownLevel3Values.Add("60");
                        breakdownLevel3Values.Add("90");
                        breakdownLevel3Values.Add("120");
                        break;

                    case "soldloc":
                        var tempLocValues = new List<string>();

                        tempLocValues = BreakDown2filteredLeadsSold.Select(x => x.SoldLocation).Distinct().OrderBy(x => x).ToList();
                        tempLocValues.AddRange(BreakDown2filteredLeads.Select(x => x.DRloc.ToUpper()).Distinct().OrderBy(x => x).ToList());

                        breakdownLevel3Values = tempLocValues.Distinct().OrderBy(x => x).ToList();

                        if (breakdownLevel3Values.Contains("FAM") && breakdownLevel3Values.Contains("FCG"))
                        {
                            breakdownLevel3Values.Remove("FCG");
                        }

                        if (breakdownLevel3Values.Contains("FTN") && breakdownLevel3Values.Contains("FTO"))
                        {
                            breakdownLevel3Values.Remove("FTO");
                        }

                        break;

                    case "make":
                        var tempMakeValues = new List<string>();

                        tempMakeValues = BreakDown2filteredLeadsSold.Where(x => !x.Make.Contains("Used")).Select(x => x.Make).Distinct().OrderBy(x => x).ToList();
                        tempMakeValues.AddRange(BreakDown2filteredLeads.Where(x => !x.Make.Contains("Used")).Select(x => x.Make.ToUpper()).Distinct().OrderBy(x => x).ToList());

                        breakdownLevel3Values = tempMakeValues.Distinct().OrderBy(x => x).ToList();
                        break;

                    case "mileage":
                        breakdownLevel3Values.Add("25000");
                        breakdownLevel3Values.Add("50000");
                        breakdownLevel3Values.Add("75000");
                        breakdownLevel3Values.Add("100000");
                        breakdownLevel3Values.Add("500000");
                        break;

                    case "model":
                        var tempModelValues = new List<string>();

                        tempModelValues = BreakDown2filteredLeadsSold.Select(x => x.Model).Distinct().OrderBy(x => x).ToList();
                        tempModelValues.AddRange(BreakDown2filteredLeads.Select(x => x.Carline).Distinct().OrderBy(x => x).ToList());

                        breakdownLevel3Values = tempModelValues.Distinct().OrderBy(x => x).ToList();
                        break;

                    case "modelyear":
                        var tempYearValues = new List<string>();

                        tempYearValues = BreakDown2filteredLeadsSold.Select(x => x.Year).Distinct().OrderBy(x => x).ToList();
                        tempYearValues.AddRange(BreakDown2filteredLeads.Select(x => x.Year).Distinct().OrderBy(x => x).ToList());

                        breakdownLevel3Values = tempYearValues.Distinct().OrderBy(x => x).ToList();
                        break;

                    case "monthyear":
                        var tempMonthYearValues = new List<string>();

                        var monthYears = BreakDown2filteredLeads.Select(x => x.LastModifiedDate.ToString("MM/yyyy")).Distinct().OrderBy(x => Convert.ToDateTime(x)).ToList();
                        tempMonthYearValues = monthYears.Distinct().OrderBy(x => Convert.ToDateTime(x)).ToList();

                        var monthYearsSold = BreakDown2filteredLeadsSold.Select(x => x.DealMonthYear.ToString("MM/yyyy")).Distinct().OrderBy(x => Convert.ToDateTime(x)).ToList();
                        tempMonthYearValues.AddRange(monthYearsSold.Distinct().OrderBy(x => Convert.ToDateTime(x)).ToList());

                        breakdownLevel3Values = tempMonthYearValues.Distinct().OrderBy(x => x).ToList();
                        break;

                    //case "associate":
                    //    breakdownLevel3Values = BreakDown2filteredLeadsSold.Select(x => x.SalesAssociate).Distinct().OrderBy(x => x).ToList();
                    //    break;

                    case "price":
                        breakdownLevel3Values.Add("10000");
                        breakdownLevel3Values.Add("20000");
                        breakdownLevel3Values.Add("30000");
                        breakdownLevel3Values.Add("40000");
                        breakdownLevel3Values.Add("50000");
                        breakdownLevel3Values.Add("60000");
                        breakdownLevel3Values.Add("70000");
                        breakdownLevel3Values.Add("80000");
                        breakdownLevel3Values.Add("90000");
                        breakdownLevel3Values.Add("100000");
                        breakdownLevel3Values.Add("200000");
                        break;

                    case "showroom":
                        var tempShowroomValues = new List<string>();


                        //tempShowroomValues = BreakDown2filteredLeadsSold.Select(x => x.Showroom).Distinct().OrderBy(x => x).ToList();

                        tempShowroomValues.AddRange(BreakDown2filteredLeads.Select(x => x.Loc.ToUpper()).Distinct().OrderBy(x => x).ToList());

                        breakdownLevel3Values = tempShowroomValues.Distinct().OrderBy(x => x).ToList();
                        break;

                    //case "stock":
                    //    var tempStockValues = new List<string>();

                    //    tempStockValues = BreakDown2filteredLeadsSold.Select(x => x.StockNumber).Distinct().OrderBy(x => x).ToList();
                    //    tempStockValues.AddRange(BreakDown2filteredLeads.Select(x => x.StockNumber).Distinct().OrderBy(x => x).ToList());

                    //    breakdownLevel3Values = tempStockValues.Distinct().OrderBy(x => x).ToList();
                    //    break;

                    case "vehiclesource":
                        var tempSourceValues = new List<string>();

                        tempSourceValues = BreakDown2filteredLeadsSold.Select(x => x.VehicleSource).Distinct().OrderBy(x => x).ToList();
                        tempSourceValues.AddRange(BreakDown2filteredLeads.Select(x => x.VehicleSource).Distinct().OrderBy(x => x).ToList());

                        breakdownLevel3Values = tempSourceValues.Distinct().OrderBy(x => x).ToList();
                        break;

                    //case "zipcode":
                    //    breakdownLevel3Values = BreakDown2filteredLeadsSold.Select(x => x.ZipCode).Distinct().OrderBy(x => x).ToList();
                    //    break;



                    default:
                        // breakdownLevel3Values = Model.AssociateLeads.Select(x => x.DealerId.ToString()).Distinct().OrderBy(x => x).ToList();
                        break;
                }

                foreach (var BreakDown3 in breakdownLevel3Values)
                {
                    var label3 = BreakDown3;
                    var BreakDown3filteredLeads = new List<SalesCommission.Models.TradeAcquisitionDetail>();
                    var BreakDown3filteredLeadsSold = new List<SalesCommission.Models.AppraisalSoldDetail>();

                    switch (Model.BreakDownLevel3)
                    {
                        //BreakDown3filteredLeads = BreakDown2filteredLeads.FindAll(x => x.Appraiser == BreakDown3);
                        case "appraiser":
                            BreakDown3filteredLeads = BreakDown2filteredLeads.FindAll(x => x.Appraiser == BreakDown3);
                            BreakDown3filteredLeadsSold = BreakDown2filteredLeadsSold.FindAll(x => x.Appraiser == BreakDown3);
                            break;

                        case "certified":

                            switch (BreakDown3)
                            {
                                case "FitzWay Value":
                                    BreakDown3filteredLeads = BreakDown2filteredLeads.FindAll(x => x.Certification.Trim() == "F915");
                                    BreakDown3filteredLeadsSold = BreakDown2filteredLeadsSold.FindAll(x => x.Certification.Trim() == "FW");
                                    break;
                                case "FitzWay Plus":
                                    BreakDown3filteredLeads = BreakDown2filteredLeads.FindAll(x => x.Certification.Trim() == "F914");
                                    BreakDown3filteredLeadsSold = BreakDown2filteredLeadsSold.FindAll(x => x.Certification.Trim() == "FP");
                                    break;
                                case "FitzWay Certified":
                                    BreakDown3filteredLeads = BreakDown2filteredLeads.FindAll(x => x.Certification.Trim() == "F910");
                                    BreakDown3filteredLeadsSold = BreakDown2filteredLeadsSold.FindAll(x => x.Certification.Trim() == "FC");
                                    break;
                                case "FitzWay Handyman":
                                    BreakDown3filteredLeads = BreakDown2filteredLeads.FindAll(x => x.Certification.Trim() == "F916" || x.Certification.Trim() == "F917" || x.Certification.Trim() == "F918");
                                    BreakDown3filteredLeadsSold = BreakDown2filteredLeadsSold.FindAll(x => x.Certification.Trim() == "HDM");
                                    break;
                                case "Manufacturer CPO":
                                    BreakDown3filteredLeads = BreakDown2filteredLeads.FindAll(x => x.Certification.Trim() == "F906" || x.Certification.Trim() == "F907" || x.Certification.Trim() == "F908" || x.Certification.Trim() == "F909" || x.Certification.Trim() == "F911" || x.Certification.Trim() == "F912" || x.Certification.Trim() == "F913" || x.Certification.Trim() == "F922" || x.Certification.Trim() == "F923");
                                    BreakDown3filteredLeadsSold = BreakDown2filteredLeadsSold.FindAll(x => x.Certification.Trim() == "MC" || x.Certification.Trim() == "CUV" || x.Certification.Trim() == "MZC" || x.Certification.Trim() == "GMU" || x.Certification.Trim() == "VWC" || x.Certification.Trim() == "CPO");
                                    break;
                                case "Other":
                                    BreakDown3filteredLeads = BreakDown2filteredLeads.FindAll(x => x.Certification.Trim() == "");
                                    BreakDown3filteredLeadsSold = BreakDown2filteredLeadsSold.FindAll(x => x.Certification.Trim() == "");
                                    break;

                            }

                            break;

                        case "days":
                            var daysbreakdown = Convert.ToDecimal(BreakDown3);

                            if (daysbreakdown == 120)
                            {
                                BreakDown3filteredLeads = BreakDown2filteredLeads.FindAll(x => Convert.ToDecimal(x.Days) >= 90);
                                BreakDown3filteredLeadsSold = BreakDown2filteredLeadsSold.FindAll(x => Convert.ToDecimal(Convert.ToDecimal(x.DaysInStock)) >= 90);
                                label3 = "> 90";
                            }
                            else
                            {
                                BreakDown3filteredLeads = BreakDown2filteredLeads.FindAll(x => Convert.ToDecimal(x.Days) < daysbreakdown && Convert.ToDecimal(x.Days) >= (daysbreakdown - 30));
                                BreakDown3filteredLeadsSold = BreakDown2filteredLeadsSold.FindAll(x => Convert.ToDecimal(x.DaysInStock) < daysbreakdown && Convert.ToDecimal(x.DaysInStock) >= (daysbreakdown - 30));
                                label3 = (daysbreakdown - 30) + " - " + (daysbreakdown - 1);
                            }
                            break;


                        case "soldloc":

                            if (BreakDown3 == "FAM")
                            {
                                BreakDown3filteredLeads = BreakDown2filteredLeads.FindAll(x => x.DRloc == "FCG");
                                BreakDown3filteredLeadsSold = BreakDown2filteredLeadsSold.FindAll(x => x.SoldLocation == "FAM");
                            }
                            else if (BreakDown3 == "FTN")
                            {
                                BreakDown3filteredLeads = BreakDown2filteredLeads.FindAll(x => x.DRloc == "FTO");
                                BreakDown3filteredLeadsSold = BreakDown2filteredLeadsSold.FindAll(x => x.SoldLocation == "FTN");
                            }
                            else
                            {
                                BreakDown3filteredLeads = BreakDown2filteredLeads.FindAll(x => x.DRloc == BreakDown3);
                                BreakDown3filteredLeadsSold = BreakDown2filteredLeadsSold.FindAll(x => x.SoldLocation == BreakDown3);
                            }



                            foreach (var store in SalesCommission.Business.Enums.SoldLocations)
                            {
                                if (store.LocationId.ToLower().Trim() == BreakDown3.ToLower().Trim())
                                {
                                    label3 = store.Name;
                                }
                            }

                            break;

                        case "make":
                            BreakDown3filteredLeads = BreakDown2filteredLeads.FindAll(x => x.Make.ToUpper() == BreakDown3);
                            BreakDown3filteredLeadsSold = BreakDown2filteredLeadsSold.FindAll(x => x.Make.ToUpper() == BreakDown3);
                            break;

                        case "mileage":
                            var milesbreakdown = Convert.ToDecimal(BreakDown3);

                            if (milesbreakdown == 500000)
                            {
                                BreakDown3filteredLeads = BreakDown2filteredLeads.FindAll(x => Convert.ToDecimal(x.Miles) >= 100000);
                                BreakDown3filteredLeadsSold = BreakDown2filteredLeadsSold.FindAll(x => Convert.ToDecimal(x.Miles) >= 100000);
                                label3 = "> 100000";
                            }
                            else
                            {
                                BreakDown3filteredLeads = BreakDown2filteredLeads.FindAll(x => Convert.ToDecimal(x.Miles) < milesbreakdown && Convert.ToDecimal(x.Miles) >= (milesbreakdown - 25000));
                                BreakDown3filteredLeadsSold = BreakDown2filteredLeadsSold.FindAll(x => Convert.ToDecimal(x.Miles) < milesbreakdown && Convert.ToDecimal(x.Miles) >= (milesbreakdown - 25000));
                                label3 = (milesbreakdown - 25000) + " - " + (milesbreakdown - 1);
                            }
                            break;

                        case "model":
                            BreakDown3filteredLeads = BreakDown2filteredLeads.FindAll(x => x.Carline == BreakDown3);
                            BreakDown3filteredLeadsSold = BreakDown2filteredLeadsSold.FindAll(x => x.Model == BreakDown3);
                            break;

                        case "modelyear":
                            BreakDown3filteredLeads = BreakDown2filteredLeads.FindAll(x => x.Year == BreakDown3);
                            BreakDown3filteredLeadsSold = BreakDown2filteredLeadsSold.FindAll(x => x.Year == BreakDown3);
                            break;

                        case "monthyear":
                            BreakDown3filteredLeads = BreakDown2filteredLeads.FindAll(x => x.LastModifiedDate.ToString("MM/yyyy") == BreakDown3);
                            BreakDown3filteredLeadsSold = BreakDown2filteredLeadsSold.FindAll(x => x.DealMonthYear.ToString("MM/yyyy") == BreakDown3);
                            var dealDate = Convert.ToDateTime(BreakDown3);
                            label3 = dealDate.Month + "/" + dealDate.Year;

                            break;

                        //case "associate":
                        //    BreakDown2filteredLeads = BreakDown2filteredLeads.FindAll(x => x.Year == BreakDown3);
                        //    BreakDown2filteredLeadsSold = BreakDown2filteredLeadsSold.FindAll(x => x.Year == BreakDown3);
                        //    break;

                        case "price":
                            var pricebreakdown = Convert.ToDecimal(BreakDown3);

                            if (pricebreakdown == 200000)
                            {
                                BreakDown3filteredLeads = BreakDown2filteredLeads.FindAll(x => x.ListAmount >= 100000);
                                BreakDown3filteredLeadsSold = BreakDown2filteredLeadsSold.FindAll(x => x.SellingPrice >= 100000);
                                label3 = "> 100000";
                            }
                            else
                            {
                                BreakDown3filteredLeads = BreakDown2filteredLeads.FindAll(x => x.ListAmount < pricebreakdown && x.ListAmount >= (pricebreakdown - 10000));
                                BreakDown3filteredLeadsSold = BreakDown2filteredLeadsSold.FindAll(x => x.SellingPrice < pricebreakdown && x.SellingPrice >= (pricebreakdown - 10000));
                                label3 = (pricebreakdown - 10000) + " - " + (pricebreakdown - 1);
                            }
                            break;

                        case "showroom":
                            BreakDown3filteredLeads = BreakDown2filteredLeads.FindAll(x => x.Loc == BreakDown3);

                            var soldBreakdown = "";

                            foreach (var mapping in SalesCommission.Business.Enums.ShowroomIDMapping)
                            {
                                if (mapping.Name == BreakDown3)
                                {
                                    soldBreakdown = mapping.LocationId;
                                    break;
                                }
                            }

                            BreakDown3filteredLeadsSold = BreakDown2filteredLeadsSold.FindAll(x => x.Showroom == soldBreakdown);

                            foreach (var store in SalesCommission.Business.Enums.AppraisalLocations)
                            {
                                if (store.LocationId.ToLower().Trim() == BreakDown3.ToLower().Trim())
                                {
                                    label3 = store.Name;
                                }
                            }

                            break;

                        //case "stock":
                        //    BreakDown2filteredLeads = BreakDown2filteredLeads.FindAll(x => x.StockNumber == BreakDown3);
                        //    BreakDown2filteredLeadsSold = BreakDown2filteredLeadsSold.FindAll(x => x.StockNumber == BreakDown3);
                        //    break;

                        case "vehiclesource":
                            BreakDown3filteredLeads = BreakDown2filteredLeads.FindAll(x => x.VehicleSource == BreakDown3);
                            BreakDown3filteredLeadsSold = BreakDown2filteredLeadsSold.FindAll(x => x.VehicleSource == BreakDown3);
                            break;

                        default:
                            BreakDown3filteredLeads = BreakDown2filteredLeads.FindAll(x => x.Loc == BreakDown3);
                            break;

                    }


                    var BD3TotalCount = BreakDown3filteredLeads.Count;
                    var BD3TotalSoldCount = BreakDown3filteredLeadsSold.Count;

                    decimal BD3TotalInvAmount = 0;
                    decimal BD3TotalFitzWayAmount = 0;
                    decimal BD3TotalMarkup = 0;

                    decimal BD3Day30Count = 0;
                    decimal BD3Day3060Count = 0;
                    decimal BD3Day6090Count = 0;
                    decimal BD3Day90Count = 0;

                    decimal BD3Day30Percent = 0;
                    decimal BD3Day3060Percent = 0;
                    decimal BD3Day6090Percent = 0;
                    decimal BD3Day90Percent = 0;

                    decimal BD3TotalSoldAmount = 0;
                    decimal BD3TotalFitzWaySoldAmount = 0;
                    decimal BD3TotalMarkupSold = 0;

                    decimal BD3Day30SoldCount = 0;
                    decimal BD3Day3060SoldCount = 0;
                    decimal BD3Day6090SoldCount = 0;
                    decimal BD3Day90SoldCount = 0;

                    decimal BD3Day30SoldPercent = 0;
                    decimal BD3Day3060SoldPercent = 0;
                    decimal BD3Day6090SoldPercent = 0;
                    decimal BD3Day90SoldPercent = 0;

                    decimal BD3TotalFrontEnd = 0;
                    decimal BD3TotalBackEnd = 0;
                    decimal BD3TotalAvgProfit = 0;
                    decimal BD3AvgFrontEnd = 0;
                    decimal BD3AvgBackEnd = 0;
                    decimal BD3AvgProfit = 0;

                    string BD3TradeDeals = "";
                    var BD3TotalWithCost = 0;
                    var BD3TotalWithInvAmount = 0;

                    decimal BD3MarkupAverage = 0;
                    decimal BD3FitzAverage = 0;
                    decimal BD3InventoryAverage = 0;

                    int BD3TradeCount = 0;
                    decimal BD3TradePercentage = 0;

                    foreach (var detail in BreakDown3filteredLeads)
                    {
                        var days = Int32.Parse(detail.Days);
                        if (days < 30)
                        {
                            BD3Day30Count += 1;
                        }
                        else if (days >= 30 && days < 60)
                        {
                            BD3Day3060Count += 1;
                        }
                        else if (days >= 60 && days < 90)
                        {
                            BD3Day6090Count += 1;
                        }
                        else if (days >= 90)
                        {
                            BD3Day90Count += 1;
                        }


                        if (detail.ListAmount > 0)
                        {
                            BD3TotalWithCost += 1;
                            BD3TotalFitzWayAmount += detail.ListAmount;
                        }

                        var halfListAmount = (detail.ListAmount * (decimal).5);
                        if (detail.InventoryAmount > halfListAmount)
                        {
                            BD3TotalWithInvAmount += 1;
                            BD3TotalMarkup += (detail.ListAmount - detail.InventoryAmount);
                        }

                        BD3TotalInvAmount += detail.InventoryAmount;
                        //BD3TotalFitzWayAmount += detail.ListAmount;
                        //BD3TotalMarkup += (detail.ListAmount - detail.InventoryAmount);
                    }
                    if (BD3TotalCount > 0)
                    {
                        BD3Day30Percent = (BD3Day30Count / BD3TotalCount);
                        BD3Day3060Percent = (BD3Day3060Count / BD3TotalCount);
                        BD3Day6090Percent = (BD3Day6090Count / BD3TotalCount);
                        BD3Day90Percent = (BD3Day90Count / BD3TotalCount);

                    }

                    if (BD3TotalWithCost > 0)
                    {
                        BD3FitzAverage = (BD3TotalFitzWayAmount / BD3TotalWithCost);
                    }

                    if (BD3TotalWithInvAmount > 0)
                    {
                        BD3MarkupAverage = (BD3TotalMarkup / BD3TotalWithInvAmount);
                        BD3InventoryAverage = (BD3TotalInvAmount / BD3TotalWithInvAmount);
                    }

                    foreach (var detail in BreakDown3filteredLeadsSold)
                    {
                        if (detail.WholesaleRetail == "R")
                        {
                            BD3TotalFrontEnd += detail.SL_FrontEndProfit;
                            BD3TotalBackEnd += detail.SL_BackEndProfit;
                            BD3TotalAvgProfit += detail.SL_AverageGrossProfit;
                        }
                        else
                        {
                            BD3TotalFrontEnd += detail.FrontEndProfit;
                            BD3TotalBackEnd += detail.BackEndProfit;
                            BD3TotalAvgProfit += detail.AverageGrossProfit;
                        }

                        var days = Int32.Parse(detail.DaysInStock);
                        if (days < 30)
                        {
                            BD3Day30SoldCount += 1;
                        }
                        else if (days >= 30 && days < 60)
                        {
                            BD3Day3060SoldCount += 1;
                        }
                        else if (days >= 60 && days < 90)
                        {
                            BD3Day6090SoldCount += 1;
                        }
                        else if (days >= 90)
                        {
                            BD3Day90SoldCount += 1;
                        }


                        if (detail.TradeCount > 0)
                        {
                            BD3TradeCount += detail.TradeCount;
                            BD3TradeDeals += detail.DealNumber + ",";
                        }

                        BD3TotalSoldAmount += detail.SellingPrice;
                        //BD3TotalFitzWaySoldAmount += detail.ListAmount;
                        //BD3TotalMarkupSold += (detail.ListAmount - detail.InventoryAmount);
                    }
                    if (BD3TotalSoldCount > 0)
                    {
                        BD3Day30SoldPercent = (BD3Day30SoldCount / BD3TotalSoldCount);
                        BD3Day3060SoldPercent = (BD3Day3060SoldCount / BD3TotalSoldCount);
                        BD3Day6090SoldPercent = (BD3Day6090SoldCount / BD3TotalSoldCount);
                        BD3Day90SoldPercent = (BD3Day90SoldCount / BD3TotalSoldCount);
                        BD3AvgFrontEnd = (BD3TotalFrontEnd / BD3TotalSoldCount);
                        BD3AvgBackEnd = (BD3TotalBackEnd / BD3TotalSoldCount);
                        BD3AvgProfit = (BD3TotalAvgProfit / BD3TotalSoldCount);
                        BD3TradePercentage = ((decimal)BD3TradeCount / BD3TotalSoldCount);
                    }


                    decimal BD3DaysSupply = 0;
                    decimal BD3SoldLast30 = 0;
                    var BD3SupplyOutput = "";

                    var soldLast30BD3 = BreakDown3filteredLeadsSold.FindAll(x => x.DealDate > DateTime.Now.AddDays(-31));
                    if (soldLast30BD3 != null)
                    {
                        BD3SoldLast30 = soldLast30BD3.Count;

                        if (BD3SoldLast30 != 0)
                        {
                            BD3DaysSupply = (30 / BD3SoldLast30) * BD3TotalCount;
                            BD3SupplyOutput = decimal.ToInt32(BD3DaysSupply).ToString();
                        }
                        else
                        {
                            BD3SupplyOutput = "Err";
                        }
                    }
                    var BD3URL = applicationPath + "/Reports/AppraisalReportInvDetails/" + "?bd1=" + Model.BreakDownLevel1 + "," + breakdown1 + "&bd2=" + Model.BreakDownLevel2 + "," + breakdown2 + "&bd3=" + Model.BreakDownLevel3 + "," +BreakDown3 + "&bd4=" + "&vs=" + Model.StatusType + "&at=" + Model.AcquisitionType + "&fm=" + Model.StatusOnFM;
                    var BD3URLSold = applicationPath + "/Reports/AppraisalReportDetails/" + "?startmonth=" + Model.ReportStartMonth.ToString() + "&startyear=" + Model.ReportStartYear.ToString() + "&endmonth=" + Model.ReportEndMonth.ToString() + "&endyear=" + Model.ReportEndYear.ToString() + "&bd1=" + Model.BreakDownLevel1 + "," + breakdown1 + "&BD3=" + Model.BreakDownLevel2 + "," + breakdown2 + "&bd3=" + Model.BreakDownLevel3 + "," + BreakDown3 + "&bd4=" + "&vt=" + Model.VehicleType + "&at=" + Model.AcquisitionType;

                    <tr class="location-bd2-collapse-@breakdown2Index collapse out location-bd3-data-row-@BreakDown3Index @label3.Replace(" ", "-").Replace(".","-").Replace("/","-").Replace("'","-").Replace("*","-").Replace("(","-").Replace(")","-")" data-collapse="location-bd3-collapse-@BreakDown3Index">

                        <td style="padding: 5px 8px" class="indent-td3"><a data-toggle="collapse" id="location-bd3-collapse-@BreakDown3Index" style="cursor: pointer;" class="location-bd3-collapse-@BreakDown3Index-href collapsed indent-3" data-target=".location-bd3-collapse-@BreakDown3Index">@label3 </a></td>
                        <td style="padding: 5px 8px" class="text-center">Inv</td>
                        <td style="padding: 5px 8px" class="text-center"><a href="@BD3URL" target="_blank">@BD3TotalCount</a></td>
                        <td style="padding: 5px 8px" class="text-center">@BD3SupplyOutput</td>
                        <td style="padding: 5px 8px" class="text-center">@BD3TotalInvAmount.ToString("C", nfi)</td>
                        <td style="padding: 5px 8px" class="text-center"><a href="@BD3URL&days=30" target="_blank">@BD3Day30Count</a></td>
                        <td style="padding: 5px 8px" class="text-center">@BD3Day30Percent.ToString("P", nfi)</td>
                        <td style="padding: 5px 8px" class="text-center"><a href="@BD3URL&days=3060" target="_blank">@BD3Day3060Count</a></td>
                        <td style="padding: 5px 8px" class="text-center">@BD3Day3060Percent.ToString("P", nfi)</td>
                        <td style="padding: 5px 8px" class="text-center"><a href="@BD3URL&days=6090" target="_blank">@BD3Day6090Count</a></td>
                        <td style="padding: 5px 8px" class="text-center">@BD3Day6090Percent.ToString("P", nfi)</td>
                        <td style="padding: 5px 8px" class="text-center"><a href="@BD3URL&days=90" target="_blank">@BD3Day90Count</a></td>
                        <td style="padding: 5px 8px" class="text-center">@BD3Day90Percent.ToString("P", nfi)</td>
                        <td style="padding: 5px 8px" class="text-center">@BD3FitzAverage.ToString("C", nfi)</td>
                        <td style="padding: 5px 8px" class="text-center">@BD3InventoryAverage.ToString("C", nfi)</td>
                        <td style="padding: 5px 8px" class="text-center">@BD3MarkupAverage.ToString("C",nfi)</td>
                        <td style="padding: 5px 8px" class="text-center"></td>
                        <td style="padding: 5px 8px" class="text-center"></td>
                        <td style="padding: 5px 8px" class="text-center"></td>
                    </tr>
                    <tr class="location-bd2-collapse-@breakdown2Index collapse out @label3.Replace(" ", "-").Replace(".","-").Replace("/","-").Replace("'","-").Replace("*","-").Replace("(","-").Replace(")","-")">
                        <td style="border-top:none; border-bottom-width:2px; padding: 5px 8px" class="indent-td3">&nbsp;</td>
                        <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">Sold</td>
                        <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center"><a href="@BD3URLSold" target="_blank">@BD3TotalSoldCount</a></td>
                        
                        @using (Html.BeginForm("AppraisalReportTradeDetails", "Reports", FormMethod.Post, new { target = "_blank", name = "BD3Form" + BreakDown3Index, id = "BD3Form" + BreakDown3Index }))
                        {
                            @Html.Hidden("tradeDeals", BD3TradeDeals);
                            @Html.Hidden("bd1", Model.BreakDownLevel1 + "," + breakdown1);
                            @Html.Hidden("bd2", Model.BreakDownLevel2 + "," + breakdown2);
                            @Html.Hidden("bd3", Model.BreakDownLevel3 + "," + BreakDown3);
                            @Html.Hidden("bd4", "");

                            @Html.Hidden("startmonth", Model.ReportStartMonth.ToString());
                            @Html.Hidden("startyear", Model.ReportStartYear.ToString());
                            @Html.Hidden("endmonth", Model.ReportEndMonth.ToString());
                            @Html.Hidden("endyear", Model.ReportEndYear.ToString());
                            @Html.Hidden("vt", Model.VehicleType);
                            @Html.Hidden("at", Model.AcquisitionType);

                            <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">
                                <a href="javascript:$('@Html.Raw("#BD3Form" + BreakDown3Index)').submit()">@BD3TradeCount</a> (@BD3TradePercentage.ToString("P", nfi))
                            </td>
                        }

                        <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">@BD3TotalSoldAmount.ToString("C", nfi)</td>
                        <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center"><a href="@BD3URLSold&days=30" target="_blank">@BD3Day30SoldCount</a></td>
                        <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">@BD3Day30SoldPercent.ToString("P", nfi)</td>
                        <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center"><a href="@BD3URLSold&days=3060" target="_blank">@BD3Day3060SoldCount</a></td>
                        <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">@BD3Day3060SoldPercent.ToString("P", nfi)</td>
                        <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center"><a href="@BD3URLSold&days=6090" target="_blank">@BD3Day6090SoldCount</a></td>
                        <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">@BD3Day6090SoldPercent.ToString("P", nfi)</td>
                        <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center"><a href="@BD3URLSold&days=90" target="_blank">@BD3Day90SoldCount</a></td>
                        <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">@BD3Day90SoldPercent.ToString("P", nfi)</td>
                        <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center"></td>
                        <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center"></td>
                        <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center"></td>
                        <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">@BD3AvgFrontEnd.ToString("C", nfi)</td>
                        <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">@BD3AvgBackEnd.ToString("C", nfi)</td>
                        <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">@BD3AvgProfit.ToString("C", nfi)</td>
                    </tr>

                    <script type="text/javascript">
                        var bAdd3 = true;
                        $("#filterBreakdown3 option").each(function () {
                            if ($(this).attr('value') == '@label3') {
                                bAdd3 = false;
                            }
                        });

                        if (bAdd3 == true) {
                            $("#filterBreakdown3").append("<option value='" + "@label3" + "'>" + "@label3" + "</option>");
                        }

                                        $(document).ready(function () {
                                            $(".location-bd3-collapse-@BreakDown3Index-href").click(function () {
                                                $('.location-bd3-data-row-@BreakDown3Index').toggleClass('selected-row');
                                                $(".location-bd3-collapse-@BreakDown3Index-href").toggleClass('changed');
                });
            });
                    </script>

                    var breakdownLevel4Values = new List<string>();

                    switch (Model.BreakDownLevel4)
                    {
                        case "appraiser":
                            var tempAppraiserValues = new List<string>();
                            tempAppraiserValues = BreakDown3filteredLeadsSold.Select(x => x.Appraiser).Distinct().OrderBy(x => x).ToList();
                            tempAppraiserValues.AddRange(BreakDown3filteredLeads.Select(x => x.Appraiser).Distinct().OrderBy(x => x).ToList());

                            breakdownLevel4Values = tempAppraiserValues.Distinct().OrderBy(x => x).ToList();
                            break;

                        case "certified":
                            //var tempCertifiedValues = new List<string>();

                            ////tempCertifiedValues = BreakDown3filteredLeadsSold.Select(x => x.Certification.Trim()).Distinct().OrderBy(x => x).ToList();
                            //tempCertifiedValues.AddRange(BreakDown3filteredLeads.Select(x => x.Certification.Trim()).Distinct().OrderBy(x => x).ToList());

                            //breakdownLevel4Values = tempCertifiedValues.Distinct().OrderBy(x => x).ToList();

                            breakdownLevel4Values.Add("FitzWay Value");
                            breakdownLevel4Values.Add("FitzWay Plus");
                            breakdownLevel4Values.Add("FitzWay Certified");
                            breakdownLevel4Values.Add("FitzWay Handyman");
                            breakdownLevel4Values.Add("Manufacturer CPO");
                            breakdownLevel4Values.Add("Other");

                            break;

                        case "days":
                            breakdownLevel4Values.Add("30");
                            breakdownLevel4Values.Add("60");
                            breakdownLevel4Values.Add("90");
                            breakdownLevel4Values.Add("120");
                            break;

                        case "soldloc":
                            var tempLocValues = new List<string>();

                            tempLocValues = BreakDown3filteredLeadsSold.Select(x => x.SoldLocation).Distinct().OrderBy(x => x).ToList();
                            tempLocValues.AddRange(BreakDown3filteredLeads.Select(x => x.DRloc.ToUpper()).Distinct().OrderBy(x => x).ToList());

                            breakdownLevel4Values = tempLocValues.Distinct().OrderBy(x => x).ToList();

                            if (breakdownLevel4Values.Contains("FAM") && breakdownLevel4Values.Contains("FCG"))
                            {
                                breakdownLevel4Values.Remove("FCG");
                            }

                            if (breakdownLevel4Values.Contains("FTN") && breakdownLevel4Values.Contains("FTO"))
                            {
                                breakdownLevel4Values.Remove("FTO");
                            }

                            break;

                        case "make":
                            var tempMakeValues = new List<string>();

                            tempMakeValues = BreakDown3filteredLeadsSold.Where(x => !x.Make.Contains("Used")).Select(x => x.Make).Distinct().OrderBy(x => x).ToList();
                            tempMakeValues.AddRange(BreakDown3filteredLeads.Where(x => !x.Make.Contains("Used")).Select(x => x.Make.ToUpper()).Distinct().OrderBy(x => x).ToList());

                            breakdownLevel4Values = tempMakeValues.Distinct().OrderBy(x => x).ToList();
                            break;

                        case "mileage":
                            breakdownLevel4Values.Add("25000");
                            breakdownLevel4Values.Add("50000");
                            breakdownLevel4Values.Add("75000");
                            breakdownLevel4Values.Add("100000");
                            breakdownLevel4Values.Add("500000");
                            break;

                        case "model":
                            var tempModelValues = new List<string>();

                            tempModelValues = BreakDown3filteredLeadsSold.Select(x => x.Model).Distinct().OrderBy(x => x).ToList();
                            tempModelValues.AddRange(BreakDown3filteredLeads.Select(x => x.Carline).Distinct().OrderBy(x => x).ToList());

                            breakdownLevel4Values = tempModelValues.Distinct().OrderBy(x => x).ToList();
                            break;

                        case "modelyear":
                            var tempYearValues = new List<string>();

                            tempYearValues = BreakDown3filteredLeadsSold.Select(x => x.Year).Distinct().OrderBy(x => x).ToList();
                            tempYearValues.AddRange(BreakDown3filteredLeads.Select(x => x.Year).Distinct().OrderBy(x => x).ToList());

                            breakdownLevel4Values = tempYearValues.Distinct().OrderBy(x => x).ToList();
                            break;

                        case "monthyear":
                            var tempMonthYearValues = new List<string>();

                            var monthYears = BreakDown3filteredLeads.Select(x => x.LastModifiedDate.ToString("MM/yyyy")).Distinct().OrderBy(x => Convert.ToDateTime(x)).ToList();
                            tempMonthYearValues = monthYears.Distinct().OrderBy(x => Convert.ToDateTime(x)).ToList();

                            var monthYearsSold = BreakDown3filteredLeadsSold.Select(x => x.DealMonthYear.ToString("MM/yyyy")).Distinct().OrderBy(x => Convert.ToDateTime(x)).ToList();
                            tempMonthYearValues.AddRange(monthYearsSold.Distinct().OrderBy(x => Convert.ToDateTime(x)).ToList());

                            breakdownLevel4Values = tempMonthYearValues.Distinct().OrderBy(x => x).ToList();
                            break;

                        //case "associate":
                        //    breakdownLevel4Values = BreakDown3filteredLeadsSold.Select(x => x.SalesAssociate).Distinct().OrderBy(x => x).ToList();
                        //    break;

                        case "price":
                            breakdownLevel4Values.Add("10000");
                            breakdownLevel4Values.Add("20000");
                            breakdownLevel4Values.Add("30000");
                            breakdownLevel4Values.Add("40000");
                            breakdownLevel4Values.Add("50000");
                            breakdownLevel4Values.Add("60000");
                            breakdownLevel4Values.Add("70000");
                            breakdownLevel4Values.Add("80000");
                            breakdownLevel4Values.Add("90000");
                            breakdownLevel4Values.Add("100000");
                            breakdownLevel4Values.Add("200000");
                            break;

                        case "showroom":
                            var tempShowroomValues = new List<string>();


                            //tempShowroomValues = BreakDown3filteredLeadsSold.Select(x => x.Showroom).Distinct().OrderBy(x => x).ToList();

                            tempShowroomValues.AddRange(BreakDown3filteredLeads.Select(x => x.Loc.ToUpper()).Distinct().OrderBy(x => x).ToList());

                            breakdownLevel4Values = tempShowroomValues.Distinct().OrderBy(x => x).ToList();
                            break;

                        //case "stock":
                        //    var tempStockValues = new List<string>();

                        //    tempStockValues = BreakDown3filteredLeadsSold.Select(x => x.StockNumber).Distinct().OrderBy(x => x).ToList();
                        //    tempStockValues.AddRange(BreakDown3filteredLeads.Select(x => x.StockNumber).Distinct().OrderBy(x => x).ToList());

                        //    breakdownLevel4Values = tempStockValues.Distinct().OrderBy(x => x).ToList();
                        //    break;

                        case "vehiclesource":
                            var tempSourceValues = new List<string>();

                            tempSourceValues = BreakDown3filteredLeadsSold.Select(x => x.VehicleSource).Distinct().OrderBy(x => x).ToList();
                            tempSourceValues.AddRange(BreakDown3filteredLeads.Select(x => x.VehicleSource).Distinct().OrderBy(x => x).ToList());

                            breakdownLevel4Values = tempSourceValues.Distinct().OrderBy(x => x).ToList();
                            break;

                        //case "zipcode":
                        //    breakdownLevel4Values = BreakDown3filteredLeadsSold.Select(x => x.ZipCode).Distinct().OrderBy(x => x).ToList();
                        //    break;



                        default:
                            // breakdownLevel4Values = Model.AssociateLeads.Select(x => x.DealerId.ToString()).Distinct().OrderBy(x => x).ToList();
                            break;
                    }

                    foreach (var BreakDown4 in breakdownLevel4Values)
                    {
                        var label4 = BreakDown4;
                        var BreakDown4filteredLeads = new List<SalesCommission.Models.TradeAcquisitionDetail>();
                        var BreakDown4filteredLeadsSold = new List<SalesCommission.Models.AppraisalSoldDetail>();

                        switch (Model.BreakDownLevel4)
                        {
                            //BreakDown4filteredLeads = BreakDown3filteredLeads.FindAll(x => x.Appraiser == BreakDown4);
                            case "appraiser":
                                BreakDown4filteredLeads = BreakDown3filteredLeads.FindAll(x => x.Appraiser == BreakDown4);
                                BreakDown4filteredLeadsSold = BreakDown3filteredLeadsSold.FindAll(x => x.Appraiser == BreakDown4);
                                break;

                            case "certified":

                                switch (BreakDown4)
                                {
                                    case "FitzWay Value":
                                        BreakDown4filteredLeads = BreakDown3filteredLeads.FindAll(x => x.Certification.Trim() == "F915");
                                        BreakDown4filteredLeadsSold = BreakDown3filteredLeadsSold.FindAll(x => x.Certification.Trim() == "FW");
                                        break;
                                    case "FitzWay Plus":
                                        BreakDown4filteredLeads = BreakDown3filteredLeads.FindAll(x => x.Certification.Trim() == "F914");
                                        BreakDown4filteredLeadsSold = BreakDown3filteredLeadsSold.FindAll(x => x.Certification.Trim() == "FP");
                                        break;
                                    case "FitzWay Certified":
                                        BreakDown4filteredLeads = BreakDown3filteredLeads.FindAll(x => x.Certification.Trim() == "F910");
                                        BreakDown4filteredLeadsSold = BreakDown3filteredLeadsSold.FindAll(x => x.Certification.Trim() == "FC");
                                        break;
                                    case "FitzWay Handyman":
                                        BreakDown4filteredLeads = BreakDown3filteredLeads.FindAll(x => x.Certification.Trim() == "F916" || x.Certification.Trim() == "F917" || x.Certification.Trim() == "F918");
                                        BreakDown4filteredLeadsSold = BreakDown3filteredLeadsSold.FindAll(x => x.Certification.Trim() == "HDM");
                                        break;
                                    case "Manufacturer CPO":
                                        BreakDown4filteredLeads = BreakDown3filteredLeads.FindAll(x => x.Certification.Trim() == "F906" || x.Certification.Trim() == "F907" || x.Certification.Trim() == "F908" || x.Certification.Trim() == "F909" || x.Certification.Trim() == "F911" || x.Certification.Trim() == "F912" || x.Certification.Trim() == "F913" || x.Certification.Trim() == "F922" || x.Certification.Trim() == "F923");
                                        BreakDown4filteredLeadsSold = BreakDown3filteredLeadsSold.FindAll(x => x.Certification.Trim() == "MC" || x.Certification.Trim() == "CUV" || x.Certification.Trim() == "MZC" || x.Certification.Trim() == "GMU" || x.Certification.Trim() == "VWC" || x.Certification.Trim() == "CPO");
                                        break;
                                    case "Other":
                                        BreakDown4filteredLeads = BreakDown3filteredLeads.FindAll(x => x.Certification.Trim() == "");
                                        BreakDown4filteredLeadsSold = BreakDown3filteredLeadsSold.FindAll(x => x.Certification.Trim() == "");
                                        break;

                                }

                                break;

                            case "days":
                                var daysbreakdown = Convert.ToDecimal(BreakDown4);

                                if (daysbreakdown == 120)
                                {
                                    BreakDown4filteredLeads = BreakDown3filteredLeads.FindAll(x => Convert.ToDecimal(x.Days) >= 90);
                                    BreakDown4filteredLeadsSold = BreakDown3filteredLeadsSold.FindAll(x => Convert.ToDecimal(Convert.ToDecimal(x.DaysInStock)) >= 90);
                                    label4 = "> 90";
                                }
                                else
                                {
                                    BreakDown4filteredLeads = BreakDown3filteredLeads.FindAll(x => Convert.ToDecimal(x.Days) < daysbreakdown && Convert.ToDecimal(x.Days) >= (daysbreakdown - 30));
                                    BreakDown4filteredLeadsSold = BreakDown3filteredLeadsSold.FindAll(x => Convert.ToDecimal(x.DaysInStock) < daysbreakdown && Convert.ToDecimal(x.DaysInStock) >= (daysbreakdown - 30));
                                    label4 = (daysbreakdown - 30) + " - " + (daysbreakdown - 1);
                                }
                                break;


                            case "soldloc":

                                if (BreakDown4 == "FAM")
                                {
                                    BreakDown4filteredLeads = BreakDown3filteredLeads.FindAll(x => x.DRloc == "FCG");
                                    BreakDown4filteredLeadsSold = BreakDown3filteredLeadsSold.FindAll(x => x.SoldLocation == "FAM");
                                }
                                else if (BreakDown4 == "FTN")
                                {
                                    BreakDown4filteredLeads = BreakDown3filteredLeads.FindAll(x => x.DRloc == "FTO");
                                    BreakDown4filteredLeadsSold = BreakDown3filteredLeadsSold.FindAll(x => x.SoldLocation == "FTN");
                                }
                                else
                                {
                                    BreakDown4filteredLeads = BreakDown3filteredLeads.FindAll(x => x.DRloc == BreakDown4);
                                    BreakDown4filteredLeadsSold = BreakDown3filteredLeadsSold.FindAll(x => x.SoldLocation == BreakDown4);
                                }



                                foreach (var store in SalesCommission.Business.Enums.SoldLocations)
                                {
                                    if (store.LocationId.ToLower().Trim() == BreakDown4.ToLower().Trim())
                                    {
                                        label4 = store.Name;
                                    }
                                }

                                break;

                            case "make":
                                BreakDown4filteredLeads = BreakDown3filteredLeads.FindAll(x => x.Make.ToUpper() == BreakDown4);
                                BreakDown4filteredLeadsSold = BreakDown3filteredLeadsSold.FindAll(x => x.Make.ToUpper() == BreakDown4);
                                break;

                            case "mileage":
                                var milesbreakdown = Convert.ToDecimal(BreakDown4);

                                if (milesbreakdown == 500000)
                                {
                                    BreakDown4filteredLeads = BreakDown3filteredLeads.FindAll(x => Convert.ToDecimal(x.Miles) >= 100000);
                                    BreakDown4filteredLeadsSold = BreakDown3filteredLeadsSold.FindAll(x => Convert.ToDecimal(x.Miles) >= 100000);
                                    label4 = "> 100000";
                                }
                                else
                                {
                                    BreakDown4filteredLeads = BreakDown3filteredLeads.FindAll(x => Convert.ToDecimal(x.Miles) < milesbreakdown && Convert.ToDecimal(x.Miles) >= (milesbreakdown - 25000));
                                    BreakDown4filteredLeadsSold = BreakDown3filteredLeadsSold.FindAll(x => Convert.ToDecimal(x.Miles) < milesbreakdown && Convert.ToDecimal(x.Miles) >= (milesbreakdown - 25000));
                                    label4 = (milesbreakdown - 25000) + " - " + (milesbreakdown - 1);
                                }
                                break;

                            case "model":
                                BreakDown4filteredLeads = BreakDown3filteredLeads.FindAll(x => x.Carline == BreakDown4);
                                BreakDown4filteredLeadsSold = BreakDown3filteredLeadsSold.FindAll(x => x.Model == BreakDown4);
                                break;

                            case "modelyear":
                                BreakDown4filteredLeads = BreakDown3filteredLeads.FindAll(x => x.Year == BreakDown4);
                                BreakDown4filteredLeadsSold = BreakDown3filteredLeadsSold.FindAll(x => x.Year == BreakDown4);
                                break;

                            case "monthyear":
                                BreakDown4filteredLeads = BreakDown3filteredLeads.FindAll(x => x.LastModifiedDate.ToString("MM/yyyy") == BreakDown4);
                                BreakDown4filteredLeadsSold = BreakDown3filteredLeadsSold.FindAll(x => x.DealMonthYear.ToString("MM/yyyy") == BreakDown4);
                                var dealDate = Convert.ToDateTime(BreakDown4);
                                label4 = dealDate.Month + "/" + dealDate.Year;

                                break;

                            //case "associate":
                            //    BreakDown3filteredLeads = BreakDown3filteredLeads.FindAll(x => x.Year == BreakDown4);
                            //    BreakDown3filteredLeadsSold = BreakDown3filteredLeadsSold.FindAll(x => x.Year == BreakDown4);
                            //    break;

                            case "price":
                                var pricebreakdown = Convert.ToDecimal(BreakDown4);

                                if (pricebreakdown == 200000)
                                {
                                    BreakDown4filteredLeads = BreakDown3filteredLeads.FindAll(x => x.ListAmount >= 100000);
                                    BreakDown4filteredLeadsSold = BreakDown3filteredLeadsSold.FindAll(x => x.SellingPrice >= 100000);
                                    label4 = "> 100000";
                                }
                                else
                                {
                                    BreakDown4filteredLeads = BreakDown3filteredLeads.FindAll(x => x.ListAmount < pricebreakdown && x.ListAmount >= (pricebreakdown - 10000));
                                    BreakDown4filteredLeadsSold = BreakDown3filteredLeadsSold.FindAll(x => x.SellingPrice < pricebreakdown && x.SellingPrice >= (pricebreakdown - 10000));
                                    label4 = (pricebreakdown - 10000) + " - " + (pricebreakdown - 1);
                                }
                                break;

                            case "showroom":
                                BreakDown4filteredLeads = BreakDown3filteredLeads.FindAll(x => x.Loc == BreakDown4);

                                var soldBreakdown = "";

                                foreach (var mapping in SalesCommission.Business.Enums.ShowroomIDMapping)
                                {
                                    if (mapping.Name == BreakDown4)
                                    {
                                        soldBreakdown = mapping.LocationId;
                                        break;
                                    }
                                }

                                BreakDown4filteredLeadsSold = BreakDown3filteredLeadsSold.FindAll(x => x.Showroom == soldBreakdown);

                                foreach (var store in SalesCommission.Business.Enums.AppraisalLocations)
                                {
                                    if (store.LocationId.ToLower().Trim() == BreakDown4.ToLower().Trim())
                                    {
                                        label4 = store.Name;
                                    }
                                }

                                break;

                            //case "stock":
                            //    BreakDown3filteredLeads = BreakDown3filteredLeads.FindAll(x => x.StockNumber == BreakDown4);
                            //    BreakDown3filteredLeadsSold = BreakDown3filteredLeadsSold.FindAll(x => x.StockNumber == BreakDown4);
                            //    break;

                            case "vehiclesource":
                                BreakDown4filteredLeads = BreakDown3filteredLeads.FindAll(x => x.VehicleSource == BreakDown4);
                                BreakDown4filteredLeadsSold = BreakDown3filteredLeadsSold.FindAll(x => x.VehicleSource == BreakDown4);
                                break;

                            default:
                                BreakDown4filteredLeads = BreakDown3filteredLeads.FindAll(x => x.Loc == BreakDown4);
                                break;

                        }


                        var BD4TotalCount = BreakDown4filteredLeads.Count;
                        var BD4TotalSoldCount = BreakDown4filteredLeadsSold.Count;

                        decimal BD4TotalInvAmount = 0;
                        decimal BD4TotalFitzWayAmount = 0;
                        decimal BD4TotalMarkup = 0;

                        decimal BD4Day30Count = 0;
                        decimal BD4Day3060Count = 0;
                        decimal BD4Day6090Count = 0;
                        decimal BD4Day90Count = 0;

                        decimal BD4Day30Percent = 0;
                        decimal BD4Day3060Percent = 0;
                        decimal BD4Day6090Percent = 0;
                        decimal BD4Day90Percent = 0;

                        decimal BD4TotalSoldAmount = 0;
                        decimal BD4TotalFitzWaySoldAmount = 0;
                        decimal BD4TotalMarkupSold = 0;

                        decimal BD4Day30SoldCount = 0;
                        decimal BD4Day3060SoldCount = 0;
                        decimal BD4Day6090SoldCount = 0;
                        decimal BD4Day90SoldCount = 0;

                        decimal BD4Day30SoldPercent = 0;
                        decimal BD4Day3060SoldPercent = 0;
                        decimal BD4Day6090SoldPercent = 0;
                        decimal BD4Day90SoldPercent = 0;

                        decimal BD4TotalFrontEnd = 0;
                        decimal BD4TotalBackEnd = 0;
                        decimal BD4TotalAvgProfit = 0;
                        decimal BD4AvgFrontEnd = 0;
                        decimal BD4AvgBackEnd = 0;
                        decimal BD4AvgProfit = 0;

                        string BD4TradeDeals = "";
                        var BD4TotalWithCost = 0;
                        var BD4TotalWithInvAmount = 0;

                        decimal BD4MarkupAverage = 0;
                        decimal BD4FitzAverage = 0;
                        decimal BD4InventoryAverage = 0;

                        int BD4TradeCount = 0;
                        decimal BD4TradePercentage = 0;

                        foreach (var detail in BreakDown4filteredLeads)
                        {
                            var days = Int32.Parse(detail.Days);
                            if (days < 30)
                            {
                                BD4Day30Count += 1;
                            }
                            else if (days >= 30 && days < 60)
                            {
                                BD4Day3060Count += 1;
                            }
                            else if (days >= 60 && days < 90)
                            {
                                BD4Day6090Count += 1;
                            }
                            else if (days >= 90)
                            {
                                BD4Day90Count += 1;
                            }


                            if (detail.ListAmount > 0)
                            {
                                BD4TotalWithCost += 1;
                                BD4TotalFitzWayAmount += detail.ListAmount;
                            }

                            var halfListAmount = (detail.ListAmount * (decimal).5);
                            if (detail.InventoryAmount > halfListAmount)
                            {
                                BD4TotalWithInvAmount += 1;
                                BD4TotalMarkup += (detail.ListAmount - detail.InventoryAmount);
                            }

                            BD4TotalInvAmount += detail.InventoryAmount;
                            //BD4TotalFitzWayAmount += detail.ListAmount;
                            //BD4TotalMarkup += (detail.ListAmount - detail.InventoryAmount);
                        }
                        if (BD4TotalCount > 0)
                        {
                            BD4Day30Percent = (BD4Day30Count / BD4TotalCount);
                            BD4Day3060Percent = (BD4Day3060Count / BD4TotalCount);
                            BD4Day6090Percent = (BD4Day6090Count / BD4TotalCount);
                            BD4Day90Percent = (BD4Day90Count / BD4TotalCount);

                        }

                        if (BD4TotalWithCost > 0)
                        {
                            BD4FitzAverage = (BD4TotalFitzWayAmount / BD4TotalWithCost);
                        }

                        if (BD4TotalWithInvAmount > 0)
                        {
                            BD4MarkupAverage = (BD4TotalMarkup / BD4TotalWithInvAmount);
                            BD4InventoryAverage = (BD4TotalInvAmount / BD4TotalWithInvAmount);
                        }

                        foreach (var detail in BreakDown4filteredLeadsSold)
                        {
                            if (detail.WholesaleRetail == "R")
                            {
                                BD4TotalFrontEnd += detail.SL_FrontEndProfit;
                                BD4TotalBackEnd += detail.SL_BackEndProfit;
                                BD4TotalAvgProfit += detail.SL_AverageGrossProfit;
                            }
                            else
                            {
                                BD4TotalFrontEnd += detail.FrontEndProfit;
                                BD4TotalBackEnd += detail.BackEndProfit;
                                BD4TotalAvgProfit += detail.AverageGrossProfit;
                            }

                            var days = Int32.Parse(detail.DaysInStock);
                            if (days < 30)
                            {
                                BD4Day30SoldCount += 1;
                            }
                            else if (days >= 30 && days < 60)
                            {
                                BD4Day3060SoldCount += 1;
                            }
                            else if (days >= 60 && days < 90)
                            {
                                BD4Day6090SoldCount += 1;
                            }
                            else if (days >= 90)
                            {
                                BD4Day90SoldCount += 1;
                            }

                            if (detail.TradeCount > 0)
                            {
                                BD4TradeCount += detail.TradeCount;
                                BD4TradeDeals += detail.DealNumber + ",";
                            }

                            BD4TotalSoldAmount += detail.SellingPrice;
                            //BD4TotalFitzWaySoldAmount += detail.ListAmount;
                            //BD4TotalMarkupSold += (detail.ListAmount - detail.InventoryAmount);
                        }
                        if (BD4TotalSoldCount > 0)
                        {
                            BD4Day30SoldPercent = (BD4Day30SoldCount / BD4TotalSoldCount);
                            BD4Day3060SoldPercent = (BD4Day3060SoldCount / BD4TotalSoldCount);
                            BD4Day6090SoldPercent = (BD4Day6090SoldCount / BD4TotalSoldCount);
                            BD4Day90SoldPercent = (BD4Day90SoldCount / BD4TotalSoldCount);
                            BD4AvgFrontEnd = (BD4TotalFrontEnd / BD4TotalSoldCount);
                            BD4AvgBackEnd = (BD4TotalBackEnd / BD4TotalSoldCount);
                            BD4AvgProfit = (BD4TotalAvgProfit / BD4TotalSoldCount);
                            BD4TradePercentage = ((decimal)BD4TradeCount / BD4TotalSoldCount);
                        }


                        decimal BD4DaysSupply = 0;
                        decimal BD4SoldLast30 = 0;
                        var BD4SupplyOutput = "";

                        var soldLast30BD4 = BreakDown4filteredLeadsSold.FindAll(x => x.DealDate > DateTime.Now.AddDays(-31));
                        if (soldLast30BD4 != null)
                        {
                            BD4SoldLast30 = soldLast30BD4.Count;

                            if (BD4SoldLast30 != 0)
                            {
                                BD4DaysSupply = (30 / BD4SoldLast30) * BD4TotalCount;
                                BD4SupplyOutput = decimal.ToInt32(BD4DaysSupply).ToString();
                            }
                            else
                            {
                                BD4SupplyOutput = "Err";
                            }
                        }

                        var BD4URL = applicationPath + "/Reports/AppraisalReportInvDetails/" + "?bd1=" + Model.BreakDownLevel1 + "," + breakdown1 + "&bd2=" + Model.BreakDownLevel2 + "," + BreakDown3 + "&BD4=" + Model.BreakDownLevel4 + "," + BreakDown4 + "&bd4=" + "&vs=" + Model.StatusType + "&at=" + Model.AcquisitionType + "&fm=" + Model.StatusOnFM;
                        var BD4URLSold = applicationPath + "/Reports/AppraisalReportDetails/" + "?startmonth=" + Model.ReportStartMonth.ToString() + "&startyear=" + Model.ReportStartYear.ToString() + "&endmonth=" + Model.ReportEndMonth.ToString() + "&endyear=" + Model.ReportEndYear.ToString() + "&bd1=" + Model.BreakDownLevel1 + "," + breakdown1 + "&BD4=" + Model.BreakDownLevel2 + "," + BreakDown3 + "&BD4=" + Model.BreakDownLevel4 + "," + BreakDown4 + "&bd4=" + "&vt=" + Model.VehicleType + "&at=" + Model.AcquisitionType;

                        <tr class="location-bd3-collapse-@BreakDown3Index collapse out location-bd4-data-row-@BreakDown4Index @label4.Replace(" ", "-").Replace(".","-").Replace("/","-").Replace("'","-").Replace("*","-").Replace("(","-").Replace(")","-")" data-collapse="location-BD4-collapse-@BreakDown4Index">

                            <td style="padding: 5px 8px" class="indent-td4"><a data-toggle="collapse" id="location-bd4-collapse-@BreakDown4Index" style="cursor: pointer;" class="location-bd4-collapse-@BreakDown4Index-href collapsed indent-4" data-target=".location-bd4-collapse-@BreakDown4Index">@label4 </a></td>
                            <td style="padding: 5px 8px" class="text-center">Inv</td>
                            <td style="padding: 5px 8px" class="text-center"><a href="@BD4URL" target="_blank">@BD4TotalCount</a></td>
                            <td style="padding: 5px 8px" class="text-center">@BD4SupplyOutput</td>
                            <td style="padding: 5px 8px" class="text-center">@BD4TotalInvAmount.ToString("C", nfi)</td>
                            <td style="padding: 5px 8px" class="text-center"><a href="@BD4URL&days=30" target="_blank">@BD4Day30Count</a></td>
                            <td style="padding: 5px 8px" class="text-center">@BD4Day30Percent.ToString("P", nfi)</td>
                            <td style="padding: 5px 8px" class="text-center"><a href="@BD4URL&days=3060" target="_blank">@BD4Day3060Count</a></td>
                            <td style="padding: 5px 8px" class="text-center">@BD4Day3060Percent.ToString("P", nfi)</td>
                            <td style="padding: 5px 8px" class="text-center"><a href="@BD4URL&days=6090" target="_blank">@BD4Day6090Count</a></td>
                            <td style="padding: 5px 8px" class="text-center">@BD4Day6090Percent.ToString("P", nfi)</td>
                            <td style="padding: 5px 8px" class="text-center"><a href="@BD4URL&days=90" target="_blank">@decimal.ToInt32(BD4Day90Count)</a></td>
                            <td style="padding: 5px 8px" class="text-center">@BD4Day90Percent.ToString("P", nfi)</td>
                            <td style="padding: 5px 8px" class="text-center">@BD4FitzAverage.ToString("C", nfi)</td>
                            <td style="padding: 5px 8px" class="text-center">@BD4InventoryAverage.ToString("C", nfi)</td>
                            <td style="padding: 5px 8px" class="text-center">@BD4MarkupAverage.ToString("C", nfi)</td>
                            <td style="padding: 5px 8px" class="text-center"></td>
                            <td style="padding: 5px 8px" class="text-center"></td>
                            <td style="padding: 5px 8px" class="text-center"></td>
                        </tr>
                        <tr class="location-bd3-collapse-@BreakDown3Index collapse out @label4.Replace(" ", "-").Replace(".","-").Replace("/","-").Replace("'","-").Replace("*","-").Replace("(","-").Replace(")","-")">
                            <td style="border-top:none; border-bottom-width:2px; padding: 5px 8px" class="indent-td4">&nbsp;</td>
                            <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">Sold</td>
                            <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center"><a href="@BD4URLSold" target="_blank">@BD4TotalSoldCount</a></td>
                            
                            @using (Html.BeginForm("AppraisalReportTradeDetails", "Reports", FormMethod.Post, new { target = "_blank", name = "BD4Form" + BreakDown4Index, id = "BD4Form" + BreakDown4Index }))
                            {
                                @Html.Hidden("tradeDeals", BD4TradeDeals);
                                @Html.Hidden("bd1", Model.BreakDownLevel1 + "," + breakdown1);
                                @Html.Hidden("bd2", Model.BreakDownLevel2 + "," + breakdown2);
                                @Html.Hidden("bd3", Model.BreakDownLevel3 + "," + BreakDown3);
                                @Html.Hidden("bd4", Model.BreakDownLevel4 + "," + BreakDown4);

                                @Html.Hidden("startmonth", Model.ReportStartMonth.ToString());
                                @Html.Hidden("startyear", Model.ReportStartYear.ToString());
                                @Html.Hidden("endmonth", Model.ReportEndMonth.ToString());
                                @Html.Hidden("endyear", Model.ReportEndYear.ToString());
                                @Html.Hidden("vt", Model.VehicleType);
                                @Html.Hidden("at", Model.AcquisitionType);

                                <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">
                                    <a href="javascript:$('@Html.Raw("#BD4Form" + BreakDown4Index)').submit()">@BD4TradeCount</a> (@BD4TradePercentage.ToString("P", nfi))
                                </td>
                            }

                            <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">@BD4TotalSoldAmount.ToString("C", nfi)</td>
                            <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center"><a href="@BD4URLSold&days=30" target="_blank">@BD4Day30SoldCount</a></td>
                            <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">@BD4Day30SoldPercent.ToString("P", nfi)</td>
                            <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center"><a href="@BD4URLSold&days=3060" target="_blank">@BD4Day3060SoldCount</a></td>
                            <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">@BD4Day3060SoldPercent.ToString("P", nfi)</td>
                            <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center"><a href="@BD4URLSold&days=6090" target="_blank">@BD4Day6090SoldCount</a></td>
                            <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">@BD4Day6090SoldPercent.ToString("P", nfi)</td>
                            <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center"><a href="@BD4URLSold&days=90" target="_blank">@BD4Day90SoldCount</a></td>
                            <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">@BD4Day90SoldPercent.ToString("P", nfi)</td>
                            <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center"></td>
                            <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center"></td>
                            <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center"></td>
                            <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">@BD4AvgFrontEnd.ToString("C", nfi)</td>
                            <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">@BD4AvgBackEnd.ToString("C", nfi)</td>
                            <td style="padding: 5px 8px; border-bottom-width:2px;" class="text-center">@BD4AvgProfit.ToString("C", nfi)</td>
                        </tr>

                        <script type="text/javascript">
                            var bAdd4 = true;
                            $("#filterBreakdown4 option").each(function () {
                                if ($(this).attr('value') == '@label4') {
                                    bAdd4 = false;
                                }
                            });

                            if (bAdd4 == true) {
                                $("#filterBreakdown4").append("<option value='" + "@label4" + "'>" + "@label4" + "</option>");
                            }

                                        $(document).ready(function () {
                                            $(".location-bd4-collapse-@BreakDown4Index-href").click(function () {
                                                $('.location-bd4-data-row-@BreakDown4Index').toggleClass('selected-row');
                                                $(".location-bd4-collapse-@BreakDown4Index-href").toggleClass('changed');
                });
            });
                        </script>






                        BreakDown4Index += 1;
                    }



                    BreakDown3Index += 1;
                }




                breakdown2Index += 1;

            }

            breakdown1Index += 1;
        }


    }


        </tbody>
        <tfoot></tfoot>
        </table>


</div>

<script>
// @@preserve jQuery.floatThead 1.2.9 - http://mkoryak.github.io/floatThead/ - Copyright (c) 2012 - 2014 Misha Koryak
// @@license MIT
!function(a){function b(a,b,c){if(8==g){var d=j.width(),e=f.debounce(function(){var a=j.width();d!=a&&(d=a,c())},a);j.on(b,e)}else j.on(b,f.debounce(c,a))}function c(a){window.console&&window.console&&window.console.log&&window.console.log(a)}function d(){var b=a('<div style="width:50px;height:50px;overflow-y:scroll;position:absolute;top:-200px;left:-200px;"><div style="height:100px;width:100%"></div>');a("body").append(b);var c=b.innerWidth(),d=a("div",b).innerWidth();return b.remove(),c-d}function e(a){if(a.dataTableSettings)for(var b=0;b<a.dataTableSettings.length;b++){var c=a.dataTableSettings[b].nTable;if(a[0]==c)return!0}return!1}a.floatThead=a.floatThead||{},a.floatThead.defaults={cellTag:null,headerCellSelector:"tr:first>th:visible",zIndex:1001,debounceResizeMs:10,useAbsolutePositioning:!0,scrollingTop:0,scrollingBottom:0,scrollContainer:function(){return a([])},getSizingRow:function(a){return a.find("tbody tr:visible:first>*")},floatTableClass:"floatThead-table",floatWrapperClass:"floatThead-wrapper",floatContainerClass:"floatThead-container",copyTableClass:!0,debug:!1};var f=window._,g=function(){for(var a=3,b=document.createElement("b"),c=b.all||[];a=1+a,b.innerHTML="<!--[if gt IE "+a+"]><i><![endif]-->",c[0];);return a>4?a:document.documentMode}(),h=null,i=function(){if(g)return!1;var b=a("<table><colgroup><col></colgroup><tbody><tr><td style='width:10px'></td></tbody></table>");a("body").append(b);var c=b.find("col").width();return b.remove(),0==c},j=a(window),k=0;a.fn.floatThead=function(l){if(l=l||{},!f&&(f=window._||a.floatThead._,!f))throw new Error("jquery.floatThead-slim.js requires underscore. You should use the non-lite version since you do not have underscore.");if(8>g)return this;if(null==h&&(h=i(),h&&(document.createElement("fthtr"),document.createElement("fthtd"),document.createElement("fthfoot"))),f.isString(l)){var m=l,n=this;return this.filter("table").each(function(){var b=a(this).data("floatThead-attached");if(b&&f.isFunction(b[m])){var c=b[m]();"undefined"!=typeof c&&(n=c)}}),n}var o=a.extend({},a.floatThead.defaults||{},l);return a.each(l,function(b){b in a.floatThead.defaults||!o.debug||c("jQuery.floatThead: used ["+b+"] key to init plugin, but that param is not an option for the plugin. Valid options are: "+f.keys(a.floatThead.defaults).join(", "))}),this.filter(":not(."+o.floatTableClass+")").each(function(){function c(a){return a+".fth-"+y+".floatTHead"}function i(){var b=0;A.find("tr:visible").each(function(){b+=a(this).outerHeight(!0)}),Z.outerHeight(b),$.outerHeight(b)}function l(){var a=z.outerWidth(),b=I.width()||a;if(X.width(b-F.vertical),O){var c=100*a/(b-F.vertical);S.css("width",c+"%")}else S.outerWidth(a)}function m(){C=(f.isFunction(o.scrollingTop)?o.scrollingTop(z):o.scrollingTop)||0,D=(f.isFunction(o.scrollingBottom)?o.scrollingBottom(z):o.scrollingBottom)||0}function n(){var b,c;if(V)b=U.find("col").length;else{var d;d=null==o.cellTag&&o.headerCellSelector?o.headerCellSelector:"tr:first>"+o.cellTag,c=A.find(d),b=0,c.each(function(){b+=parseInt(a(this).attr("colspan")||1,10)})}if(b!=H){H=b;for(var e=[],f=[],g=[],i=0;b>i;i++)e.push('<th class="floatThead-col"/>'),f.push("<col/>"),g.push("<fthtd style='display:table-cell;height:0;width:auto;'/>");f=f.join(""),e=e.join(""),h&&(g=g.join(""),W.html(g),bb=W.find("fthtd")),Z.html(e),$=Z.find("th"),V||U.html(f),_=U.find("col"),T.html(f),ab=T.find("col")}return b}function p(){if(!E){if(E=!0,J){var a=z.width(),b=Q.width();a>b&&z.css("minWidth",a)}z.css(db),S.css(db),S.append(A),B.before(Y),i()}}function q(){E&&(E=!1,J&&z.width(fb),Y.detach(),z.prepend(A),z.css(eb),S.css(eb))}function r(a){J!=a&&(J=a,X.css({position:J?"absolute":"fixed"}))}function s(a,b,c,d){return h?c:d?o.getSizingRow(a,b,c):b}function t(){var a,b=n();return function(){var c=s(z,_,bb,g);if(c.length==b&&b>0){if(!V)for(a=0;b>a;a++)_.eq(a).css("width","");q();var d=[];for(a=0;b>a;a++)d[a]=c.get(a).offsetWidth;for(a=0;b>a;a++)ab.eq(a).width(d[a]),_.eq(a).width(d[a]);p()}else S.append(A),z.css(eb),S.css(eb),i()}}function u(a){var b=I.css("border-"+a+"-width"),c=0;return b&&~b.indexOf("px")&&(c=parseInt(b,10)),c}function v(){var a,b=I.scrollTop(),c=0,d=L?K.outerHeight(!0):0,e=M?d:-d,f=X.height(),g=z.offset(),i=0;if(O){var k=I.offset();c=g.top-k.top+b,L&&M&&(c+=d),c-=u("top"),i=u("left")}else a=g.top-C-f+D+F.horizontal;var l=j.scrollTop(),m=j.scrollLeft(),n=I.scrollLeft();return b=I.scrollTop(),function(k){if("windowScroll"==k?(l=j.scrollTop(),m=j.scrollLeft()):"containerScroll"==k?(b=I.scrollTop(),n=I.scrollLeft()):"init"!=k&&(l=j.scrollTop(),m=j.scrollLeft(),b=I.scrollTop(),n=I.scrollLeft()),!h||!(0>l||0>m)){if(R)r("windowScrollDone"==k?!0:!1);else if("windowScrollDone"==k)return null;g=z.offset(),L&&M&&(g.top+=d);var o,s,t=z.outerHeight();if(O&&J){if(c>=b){var u=c-b;o=u>0?u:0}else o=P?0:b;s=i}else!O&&J?(l>a+t+e?o=t-f+e:g.top>l+C?(o=0,q()):(o=C+l-g.top+c+(M?d:0),p()),s=0):O&&!J?(c>b||b-c>t?(o=g.top-l,q()):(o=g.top+b-l-c,p()),s=g.left+n-m):O||J||(l>a+t+e?o=t+C-l+a+e:g.top>l+C?(o=g.top-l,p()):o=C,s=g.left-m);return{top:o,left:s}}}}function w(){var a=null,b=null,c=null;return function(d,e,f){null==d||a==d.top&&b==d.left||(X.css({top:d.top,left:d.left}),a=d.top,b=d.left),e&&l(),f&&i();var g=I.scrollLeft();J&&c==g||(X.scrollLeft(g),c=g)}}function x(){if(I.length){var a=I.width(),b=I.height(),c=z.height(),d=z.width(),e=d>a?G:0,f=c>b?G:0;F.horizontal=d>a-f?G:0,F.vertical=c>b-e?G:0}}var y=k,z=a(this);if(z.data("floatThead-attached"))return!0;if(!z.is("table"))throw new Error('jQuery.floatThead must be run on a table element. ex: $("table").floatThead();');var A=z.find("thead:first"),B=z.find("tbody:first");if(0==A.length)throw new Error("jQuery.floatThead must be run on a table that contains a <thead> element");var C,D,E=!1,F={vertical:0,horizontal:0},G=d(),H=0,I=o.scrollContainer(z)||a([]),J=o.useAbsolutePositioning;null==J&&(J=o.scrollContainer(z).length);var K=z.find("caption"),L=1==K.length;if(L)var M="top"===(K.css("caption-side")||K.attr("align")||"top");var N=a('<fthfoot style="display:table-footer-group;"/>'),O=I.length>0,P=!1,Q=a([]),R=9>=g&&!O&&J,S=a("<table/>"),T=a("<colgroup/>"),U=z.find("colgroup:first"),V=!0;0==U.length&&(U=a("<colgroup/>"),V=!1);var W=a('<fthrow style="display:table-row;height:0;"/>'),X=a('<div style="overflow: hidden;"></div>'),Y=a("<thead/>"),Z=a('<tr class="size-row"/>'),$=a([]),_=a([]),ab=a([]),bb=a([]);if(Y.append(Z),z.prepend(U),h&&(N.append(W),z.append(N)),S.append(T),X.append(S),o.copyTableClass&&S.attr("class",z.attr("class")),S.attr({cellpadding:z.attr("cellpadding"),cellspacing:z.attr("cellspacing"),border:z.attr("border")}),S.css({borderCollapse:z.css("borderCollapse"),border:z.css("border")}),S.addClass(o.floatTableClass).css("margin",0),J){var cb=function(a,b){var c=a.css("position"),d="relative"==c||"absolute"==c;if(!d||b){var e={paddingLeft:a.css("paddingLeft"),paddingRight:a.css("paddingRight")};X.css(e),a=a.wrap("<div class='"+o.floatWrapperClass+"' style='position: relative; clear:both;'></div>").parent(),P=!0}return a};O?(Q=cb(I,!0),Q.append(X)):(Q=cb(z),z.after(X))}else z.after(X);X.css({position:J?"absolute":"fixed",marginTop:0,top:J?0:"auto",zIndex:o.zIndex}),X.addClass(o.floatContainerClass),m();var db={"table-layout":"fixed"},eb={"table-layout":z.css("tableLayout")||"auto"},fb=z[0].style.width||"";x();var gb,hb=function(){(gb=t())()};hb();var ib=v(),jb=w();jb(ib("init"),!0);var kb=f.debounce(function(){jb(ib("windowScrollDone"),!1)},300),lb=function(){jb(ib("windowScroll"),!1),kb()},mb=function(){jb(ib("containerScroll"),!1)},nb=function(){m(),x(),hb(),ib=v(),(jb=w())(ib("resize"),!0,!0)},ob=f.debounce(function(){x(),m(),hb(),ib=v(),jb(ib("reflow"),!0)},1);O?J?I.on(c("scroll"),mb):(I.on(c("scroll"),mb),j.on(c("scroll"),lb)):j.on(c("scroll"),lb),j.on(c("load"),ob),b(o.debounceResizeMs,c("resize"),nb),z.on("reflow",ob),e(z)&&z.on("filter",ob).on("sort",ob).on("page",ob),z.data("floatThead-attached",{destroy:function(){var a=".fth-"+y;q(),z.css(eb),U.remove(),h&&N.remove(),Y.parent().length&&Y.replaceWith(A),z.off("reflow"),I.off(a),P&&(I.length?I.unwrap():z.unwrap()),J&&z.css("minWidth",""),X.remove(),z.data("floatThead-attached",!1),j.off(a)},reflow:function(){ob()},setHeaderHeight:function(){i()},getFloatContainer:function(){return X},getRowGroups:function(){return E?X.find("thead").add(z.find("tbody,tfoot")):z.find("thead,tbody,tfoot")}}),k++}),this}}(jQuery),function(a){a.floatThead=a.floatThead||{},a.floatThead._=window._||function(){var b={},c=Object.prototype.hasOwnProperty,d=["Arguments","Function","String","Number","Date","RegExp"];return b.has=function(a,b){return c.call(a,b)},b.keys=function(a){if(a!==Object(a))throw new TypeError("Invalid object");var c=[];for(var d in a)b.has(a,d)&&c.push(d);return c},a.each(d,function(){var a=this;b["is"+a]=function(b){return Object.prototype.toString.call(b)=="[object "+a+"]"}}),b.debounce=function(a,b,c){var d,e,f,g,h;return function(){f=this,e=arguments,g=new Date;var i=function(){var j=new Date-g;b>j?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e)))},j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e)),h}},b}()}(jQuery);



$(document).ready(function(){

$(".sticky-header").floatThead({scrollingTop:70});


//$("#filterBreakdown1").change(function () {

//    var pickedValue = $(this).val();
//    //pickedValue.forEach(element => element.replaceAll(" ", "-").replaceAll("/", "-"));
//    //var showClass = pickedValue.replaceAll(" ", "-").replaceAll("/", "-");//.Replace(".", "-").Replace("/", "-").Replace("'", "-").Replace("*", "-").Replace("(", "-").Replace(")", "-");

//    if (pickedValue != null) {
//        var arrayLength = pickedValue.length;

//        $("#filterBreakdown1 option").each(function () {

//            if ($(this).attr('value') != '') {

//                var hideClass = $(this).attr('value').replaceAll(" ", "-").replaceAll("/", "-");
//                $('.' + hideClass).hide();
//            }
//        });


//        for (var i = 0; i < arrayLength; i++) {
//            var showClass = pickedValue[i].replaceAll(" ", "-").replaceAll("/", "-");
//            $('.' + showClass).show();
//        }
//    }
//    else {
//        $("#filterBreakdown1 option").each(function () {

//            if ($(this).attr('value') != '') {

//                var showClass = $(this).attr('value').replaceAll(" ", "-").replaceAll("/", "-");
//                $('.' + showClass).show();
//            }
//        });
//    }
//});

//$("#filterBreakdown2").change(function () {

//    var pickedValue = $(this).val();
//    //pickedValue.forEach(element => element.replaceAll(" ", "-").replaceAll("/", "-"));
//    //var showClass = pickedValue.replaceAll(" ", "-").replaceAll("/", "-");//.Replace(".", "-").Replace("/", "-").Replace("'", "-").Replace("*", "-").Replace("(", "-").Replace(")", "-");

//    if (pickedValue != null) {
//        var arrayLength = pickedValue.length;

//        $("#filterBreakdown2 option").each(function () {

//            if ($(this).attr('value') != '') {

//                var hideClass = $(this).attr('value').replaceAll(" ", "-").replaceAll("/", "-");
//                $('.' + hideClass).hide();
//            }
//        });


//        for (var i = 0; i < arrayLength; i++) {
//            var showClass = pickedValue[i].replaceAll(" ", "-").replaceAll("/", "-");
//            $('.' + showClass).show();
//        }
//    }
//    else {
//        $("#filterBreakdown2 option").each(function () {

//            if ($(this).attr('value') != '') {

//                var showClass = $(this).attr('value').replaceAll(" ", "-").replaceAll("/", "-");
//                $('.' + showClass).show();
//            }
//        });
//    }
//});

//$("#filterBreakdown3").change(function () {

//    var pickedValue = $(this).val();
//    //pickedValue.forEach(element => element.replaceAll(" ", "-").replaceAll("/", "-"));
//    //var showClass = pickedValue.replaceAll(" ", "-").replaceAll("/", "-");//.Replace(".", "-").Replace("/", "-").Replace("'", "-").Replace("*", "-").Replace("(", "-").Replace(")", "-");

//    if (pickedValue != null) {
//        var arrayLength = pickedValue.length;

//        $("#filterBreakdown3 option").each(function () {

//            if ($(this).attr('value') != '') {

//                var hideClass = $(this).attr('value').replaceAll(" ", "-").replaceAll("/", "-");
//                $('.' + hideClass).hide();
//            }
//        });


//        for (var i = 0; i < arrayLength; i++) {
//            var showClass = pickedValue[i].replaceAll(" ", "-").replaceAll("/", "-");
//            $('.' + showClass).show();
//        }
//    }
//    else {
//        $("#filterBreakdown3 option").each(function () {

//            if ($(this).attr('value') != '') {

//                var showClass = $(this).attr('value').replaceAll(" ", "-").replaceAll("/", "-");
//                $('.' + showClass).show();
//            }
//        });
//    }
//});

//$("#filterBreakdown4").change(function () {

//    var pickedValue = $(this).val();
//    //pickedValue.forEach(element => element.replaceAll(" ", "-").replaceAll("/", "-"));
//    //var showClass = pickedValue.replaceAll(" ", "-").replaceAll("/", "-");//.Replace(".", "-").Replace("/", "-").Replace("'", "-").Replace("*", "-").Replace("(", "-").Replace(")", "-");

//    if (pickedValue != null) {
//        var arrayLength = pickedValue.length;

//        $("#filterBreakdown4 option").each(function () {

//            if ($(this).attr('value') != '') {

//                var hideClass = $(this).attr('value').replaceAll(" ", "-").replaceAll("/", "-");
//                $('.' + hideClass).hide();
//            }
//        });


//        for (var i = 0; i < arrayLength; i++) {
//            var showClass = pickedValue[i].replaceAll(" ", "-").replaceAll("/", "-");
//            $('.' + showClass).show();
//        }
//    }
//    else {
//        $("#filterBreakdown4 option").each(function () {

//            if ($(this).attr('value') != '') {

//                var showClass = $(this).attr('value').replaceAll(" ", "-").replaceAll("/", "-");
//                $('.' + showClass).show();
//            }
//        });
//    }
//});

});
    </script>